<?php 
 class Wyomind_Massstockupdate_Model_Import extends Mage_Core_Model_Abstract { public $_warnings = array();  public $_notices = array();  public $_sql = array();  public $_columns = array();  public $_products = array();  public $_stocks = array();  public $_autoInc = 0;  public $_tables = array();  public $_total = false;  public $_is_in_stock = false;  public $x23 = false;  public $_output = array();  public $x24 = array();  public function _construct() { $x6d="\x69\156i\x5f\x73\145\x74";  $x6e="\163\x74r\151s\164\x72";  $x6f="i\x73\137r\x65\141dab\154e";  $x70="\x74\151\155\x65";  $x71="\x66\151\x6ce\137\147\x65t\137\143\x6f\x6eten\x74s";  $x72="i\156_\x61\x72\162ay";  $x73="i\155\x70\154\x6f\144e";  $x74="ar\162\x61\x79_\x6b\145\171\x5fe\170\x69s\164s";  $x75="\164\x72\151m";  $x76="\x73t\162\x5fr\x65\x70\x6c\141\143e";  $x77="\x6c\x6f\147";  $x78="\x69\163\x5f\141rr\141y";  $x79="\x6a\163\157\156\137e\156c\157de";  $x7a="\x6a\x73o\156\x5f\x64ec\x6f\x64\x65";  $x7b="\141\162\162ay\137\163\x70\x6c\151c\145";  $x7c="\x61\x72\162a\x79_\165\x6e\x73\150\x69ft";  $x7d="\x63ou\x6et";  $x7e="is\x5f\x6e\165me\x72\x69c";  $x7f="ar\x72a\x79\137\160\165\163\x68";  $x80="\163tr\164\157lo\x77\145r";  $x81="s\x74\162s\164\x72";  $x82="e\x78\160l\x6f\x64\145";  $x83="\x61dds\154\x61\163h\145\x73";  parent::_construct();  $this->_init("\155\x61s\163\x73\x74\157\143\x6bu\160d\x61t\x65/i\155por\164");  } protected function _beforeSave() { $x6d="i\x6ei\137set";  $x6e="st\x72\x69st\162";  $x6f="\151\x73_\x72\x65ad\141bl\x65";  $x70="\164i\155\x65";  $x71="\146i\x6ce\137\147\145\x74\137\143\x6f\156te\x6e\x74\163";  $x72="\151\x6e_\141rray";  $x73="\151\x6d\160\x6co\144e";  $x74="ar\162\x61\x79_\153\145\x79\137\x65x\151\163\x74s";  $x75="t\x72\151\155";  $x76="\x73\x74\162\x5f\162\145\160l\141\x63\145";  $x77="\x6cog";  $x78="\151s_a\162\x72\141\171";  $x79="\x6as\x6f\156_e\156\x63\x6fd\145";  $x7a="\152s\x6f\x6e\137\x64e\143\157\x64\x65";  $x7b="\141\162\x72\141\171_sp\154\x69c\145";  $x7c="\141\162\162\x61y_\x75\156\163h\151f\x74";  $x7d="c\157u\x6et";  $x7e="\x69s\x5f\156\165m\x65\162\151\143";  $x7f="\141\162\x72\x61\x79\137\x70u\163\x68";  $x80="\163t\x72\x74\157\154o\x77\145\x72";  $x81="s\164r\x73t\162";  $x82="e\x78p\154o\x64e";  $x83="a\x64d\163\154a\x73h\145s";  if ($this->getFileSystemType() !== "\61") { $x25 = new Varien_Io_File();  $x26 = $x25->getCleanPath(Mage::getBaseDir() . "\x2f" . $this->getFilePath());  if (!$x25->fileExists($x26, false)) { Mage::throwException(Mage::helper("ma\163s\x73t\x6f\x63\x6b\165\x70d\141\x74\x65")->__("\x57\x72o\156\x67\x20\x66\151\x6c\x65 \x70a\164\150\56\40\47\x25\163\47 \151s\x20\x6eot a f\x69l\145\x2e", $x26));  } if ($x6e($this->getFilePath(), "\x2ec\163\x76") < 0) { Mage::throwException(Mage::helper("ma\163s\x73t\x6f\x63\x6b\165\x70d\141\x74\x65")->__("\x57\162\157\x6e\x67\40f\x69\154e.\40'\45\x73\x27\40\151\163\x20\156\157\164 a\x20\143s\x76 f\151\154\x65\56", $x26));  } if (!$x6f($x26)) { Mage::throwException(Mage::helper("ma\163s\x73t\x6f\x63\x6b\165\x70d\141\x74\x65")->__("\x50l\x65a\163\x65 \x6d\x61ke \163\165\x72\x65\x20th\x61t\x20'\45\163'\40is \162e\141d\141\x62l\x65\x20b\x79\x20we\142-s\145\162v\145\162.", $x26));  } } return parent::_beforeSave();  } public function x84() { $x6d="\x69\156\151_\x73e\x74";  $x6e="\x73\164r\x69s\164r";  $x6f="is\137\162\145a\x64\141\x62\x6ce";  $x70="t\x69m\145";  $x71="\146il\x65\137\147\x65\x74\137\143o\x6eten\164\163";  $x72="\151n_\x61r\x72\141y";  $x73="\151\x6d\160\154\x6f\x64\x65";  $x74="\x61r\x72\141\171\137k\x65y\137\145\170\x69\x73t\163";  $x75="tr\151m";  $x76="\163\164\x72\137\x72\145p\154a\x63e";  $x77="\x6c\x6f\x67";  $x78="\151\163\137\141r\x72a\x79";  $x79="j\x73\157\156_\x65\156\x63\x6fde";  $x7a="\x6a\163on\x5f\144e\143\x6fd\145";  $x7b="\141\162\x72ay_\x73p\x6cic\145";  $x7c="\141\162\162a\171_u\x6es\x68\x69f\164";  $x7d="\143\157\x75n\164";  $x7e="\151\x73_numer\151c";  $x7f="a\x72\x72\x61\171_\x70\x75\163\x68";  $x80="\163\164\x72\164\157l\x6f\x77er";  $x81="\163\164\x72\163\x74\x72";  $x82="\x65\x78\x70lod\x65";  $x83="\x61\x64ds\x6ca\163\x68\145s";  $this->_warnings = array();  $this->_notices = array();  $this->_sql = array();  $this->_columns = array();  $this->_products = array();  $this->_stocks = array();  $this->_autoInc = 0;  $this->_tables = array();  $this->_total = false;  $this->_output = array();
 } private function x85() { $x6d="\151\x6e\x69\x5f\x73\x65\x74";  $x6e="\x73t\162\x69\x73t\x72";  $x6f="\151s\x5f\x72e\x61\x64\x61\x62\x6ce";  $x70="\164i\155\145";  $x71="\146\x69\x6c\145\137\147e\164\137c\x6fn\x74\145n\x74s";  $x72="i\156\x5f\141\162\162\141\171";  $x73="\151\155p\154o\144e";  $x74="\x61\162\x72\141y_\x6b\145y\137\x65xi\x73\x74\163";  $x75="t\162i\x6d";  $x76="s\x74r\137\162\145\160l\141c\145";  $x77="\154\157g";  $x78="\x69\163_\x61rr\141\x79";  $x79="\152\163\x6f\156\x5fe\x6ec\x6f\x64e";  $x7a="\x6a\163\x6f\156\x5f\x64e\x63o\144\145";  $x7b="\141r\x72\141y\x5f\x73\160\x6ci\x63\145";  $x7c="\x61\x72\162\x61y\137\x75nsh\x69\x66t";  $x7d="\x63\x6funt";  $x7e="\151\163\137\156\x75\155\145\x72\x69c";  $x7f="a\x72\162\x61\171_\160\x75\163h";  $x80="s\x74rt\157l\x6f\167\145r";  $x81="\163\x74\162st\162";  $x82="\145\170\160\154\x6f\144e";  $x83="ad\x64\163\154\x61s\x68\x65s";  $x27 = $this->getFtpHost();  $x28 = $this->getFtpLogin();  $x29 = $this->getFtpPassword();  $x2a = $this->getFtpDir();  $x2b = $this->getUseSftp();  $x2c = $this->getFtpActive();  if ($x2b) $x2d = new Varien_Io_Sftp();  else $x2d = new Varien_Io_Ftp();  try { $x2d->open( array( 'host' => $x27, 'user' => $x28, 'username' => $x28, 'password' => $x29, 'timeout' => '120', 'path' => $x2a, 'passive' => !($x2c) ) );  if ($x2d->cd($x2a)) { $x2e = 'var/tmp/stock_import_' . $x70() . '.csv';  $x25 = new Varien_Io_File();  $x26 = $x25->getCleanPath(Mage::getBaseDir() . '/var/tmp/');  if ($x6f($x26)) { $x2f = $x2d->read($this->getFilePath(), $x2e);  $x2d->close();  if (!$x2f) { return array("\124\x68\x65\x20\146i\x6c\145\40'".$this->getFilePath()."\x27\40\143\x61\156\156\157\164 \142\x65\40\x66e\x74c\150\x65\144.");  } return $x2e;  } else { $x2d->close();  return array("Ple\x61\x73\145\x20\x6da\153\x65\x20\x73\165\162\145 t\x68\141\164\x20\x76\141\x72\57\164m\160 \151\x73\40\167\x72\151t\x61ble.");  } } else { $x2d->close();  return array("Cannot access '$x2a' on this server.");  } } catch (Exception $x30) { return $x30->getMessage();  } } public function x86($x31,$x32) { $x6d="i\x6e\x69\137\x73e\x74";  $x6e="\x73\x74\162\151\x73\x74r";  $x6f="\151\163\137re\x61\144\141\x62\154e";  $x70="\164im\145";  $x71="\x66i\154\145\x5f\x67\145\x74\137c\x6fn\164\145n\164s";  $x72="\151n_\x61\x72\162\141\x79";  $x73="\x69\155\160\x6c\x6f\x64\x65";  $x74="\x61r\162\x61y\x5f\x6b\145y\137\x65\170ists";  $x75="\x74ri\155";  $x76="s\x74r\x5f\162\145p\154a\x63e";  $x77="lo\x67";  $x78="\x69s\137\141\x72\162a\x79";  $x79="js\x6f\156_\145\x6e\143\x6f\x64e";  $x7a="\x6a\x73\x6f\156\x5f\144\x65\x63\157\x64\x65";  $x7b="a\162r\x61y_\163p\x6c\151\143\145";  $x7c="a\x72\x72\x61y\x5f\165\156\x73h\151ft";  $x7d="\x63\x6fu\156\x74";  $x7e="i\x73\137n\165\155e\x72\x69c";  $x7f="\141\162\162\141y_pus\x68";  $x80="\x73\x74rto\154\x6fw\145r";  $x81="\x73\164rs\x74\162";  $x82="\x65\x78\160\x6c\x6f\x64e";  $x83="\141\144d\x73\x6c\141\x73\150e\x73";  $x33 = new SimpleXMLElement($x71($x31));  $x33 = $x33->xpath($x32);  $x34 = array();  $x35 = array();  foreach ($x33 as $x36) { $x37 = array();  foreach ($x36 as $x38 => $x39) { if (!$x72($x38, $x34)) { $x34[] = $x38;  } $x37[$x38] = (string) $x39;  } $x35[] = $x37;  } $x3a = $x73("\x3b", $x34) . "\x0a";  $x3b = 0;  foreach ($x35 as $x36) { $x37 = array();  foreach ($x34 as $x3c) { if ($x74($x3c, $x36)) { $x37[] = $x75($x76("\x0a", "\x20", $x36[$x3c]));  } else { $x37[] = "";  } } $x3a .= $x73("\x3b", $x37) . "\x0a";  } $x25 = new Varien_Io_File();  $x25->setAllowCreateFolders(true);  $x26 = $x25->getCleanPath(Mage::getBaseDir() . '/var/tmp/');  $x25->open(array('path' => $x26));  $x3d = "\x6dsu\x5f".$x70() . "\x2ec\163\x76";  if ($x25->isWriteable($x26)) { $x25->streamOpen($x26.$x3d,'w');  $x25->streamWrite($x3a);  $x25->streamClose();  return "\166\x61\x72/\164m\x70\57".$x3d;  } else { return array("Cannot access '$x26' on this server.");  } } public function importProcess() { $x6d="\x69\156\x69_\163\x65\164";  $x6e="\x73\x74r\x69\x73\x74r";  $x6f="\x69\x73\x5f\162\x65\x61\144ab\x6c\x65";  $x70="\x74i\x6d\145";  $x71="\146\151le\137\147\145\164_con\x74\x65nt\163";  $x72="\x69n_\x61\x72\162\x61\x79";  $x73="\151\x6d\x70\x6c\x6fde";  $x74="\141\162\162\x61\x79\x5fkey\137e\x78\151\163ts";  $x75="trim";
 $x76="\x73\x74\x72\x5fr\x65\160\x6c\x61\x63e";  $x77="lo\147";  $x78="\x69s\137ar\162\141\171";  $x79="\152\x73\x6f\156\x5fe\x6eco\x64\x65";  $x7a="j\163o\x6e_\x64\x65co\x64e";  $x7b="\141\x72ra\x79_\163\160\x6c\x69\143\145";  $x7c="\141\162\162a\171\137u\156\163\x68\151\146\x74";  $x7d="\143ou\156t";  $x7e="is\x5f\156u\x6d\x65\162\151\143";  $x7f="\141\x72\x72\x61\171\137pu\x73h";  $x80="\x73\164\x72to\x6c\157\167\x65r";  $x81="\163tr\163\164\162";  $x82="ex\x70\x6c\x6fd\x65";  $x83="\141ddsl\141s\150e\163";  Mage::$x77("\55\55---\55--\x2d\55--\x2d--\55\55-\55\55\40\x49\115\x50\x4fRTAT\x49\x4f\x4e \x50\x52\117\103E\123S\x20\55\55\55\x2d\55--\55\55\x2d-\55-\x2d\55", null, "\115\x61\163\x73\123t\157\x63k\125\160\141\x74\x65\x2e\154\157g");  $this->x84();  $x3e = $this->getFilePath();  if ($this->getFileSystemType() === "\61") { $x2f = $this->x85();  if ($x78($x2f)) { $x3f['status'] = 'error';  $x3f['body'] = $x2f[0];  die($x79($x3f));  } else { $x3e = $x2f;  } } $x25 = new Varien_Io_File();  $x26 = $x25->getCleanPath(Mage::getBaseDir() . "\x2f" . $x3e);  if ($this->getFileType() === "\61") { $x3d = $this->x86($x26,$this->getXpathToProduct());  if ($x78($x3d)) { $x3f['status'] = 'error';  $x3f['body'] = $x3d[0];  die($x79($x3f));  } $x26 = $x25->getCleanPath(Mage::getBaseDir() . '/' . $x3d);  } $x25->streamOpen($x26, "r");  Mage::$x77("\55\x2d\76\x20\106i\x6ce\40\x6f\160\x65\x6e\x65\x64\40:\40" . $x26, null, "\115\x61\163\x73\123t\157\x63k\125\160\141\x74\x65\x2e\154\157g");  $x40 = $this->getIdentifierCode() ? $this->getIdentifierCode() : "s\153\165";  $x35 = Mage::getModel("\143\141\x74\141l\x6f\147\57\x70\x72\x6fdu\x63\x74")->getCollection()->addAttributeToSelect($x40);  foreach ($x35 as $x41) { $this->_products[$x75($x41->getData($x40))] = $x41->getId();  };  Mage::$x77("\x2d\55>\x20\x50\162\x6f\144\165\x63\164s \x63\157\154\154e\143\x74ed", null, "\115\x61\163\x73\123t\157\x63k\125\160\141\x74\x65\x2e\154\157g");  if (Mage::helper("\143or\145")->isModuleEnabled("\x57\x79om\x69\156d_\x41\144v\x61\x6ece\x64\151n\x76\x65\156\x74\x6fr\171")) { $x42 = Mage::getModel("a\144va\x6e\143\x65\144\x69n\166en\x74o\162\x79/stoc\x6b")->getCollection();  foreach ($x42 as $x43) { $this->_stocks[$x43->getProductId()] = $x43->getId();  };  Mage::$x77("\55-\76 Lo\143\x61\154\x20\x73\164\157c\153s \143\x6fl\x6c\x65\143\164\x65\144\x20\x28\x41\x64\166\141n\x63\145d \x49\x6e\166\x65\156\x74\157\x72\171\x29", null, "\115\x61\163\x73\123t\157\x63k\125\160\141\x74\x65\x2e\154\157g");  } $x44 = array("\x61\143" => "\141\x63\164\x69\x76a\x74io\156\x5fc\157\144e", "\141k" => "a\x63tivati\x6f\x6e\137k\x65\x79", "\142\x75" => "\142\141\163\145\137\x75\162\x6c", "\155\144" => "\155d\65", "\x74h" => "\164\x68i\163", "\x64\x6d" => "\x5f\144\145\155o", "\x65\x78t" => "\x6d\163\x69", "v\x65r" => "\63\x2e\71\56\61");  $x45 = Mage::getSingleton("\x63\157\162\145\x2fr\x65\x73ou\162c\x65");  $x46 = $x45->getConnection("\x63\157\x72e\x5fr\145\141d");  $this->_tables["\143\163\151"] = Mage::getSingleton("\x63\157\162\145\x2fr\x65\x73ou\162c\x65")->getTableName("\143\141\164a\154\157\x67\x69nv\145n\164o\162\x79\x5f\x73\x74\157ck_\x69\164\x65m");  if (Mage::helper("\143or\145")->isModuleEnabled("\x57\x79om\x69\156d_\x41\144v\x61\x6ece\x64\151n\x76\x65\156\x74\x6fr\171")) { $this->_tables["\141\x69\x70"] = Mage::getSingleton("\x63\157\162\145\x2fr\x65\x73ou\162c\x65")->getTableName("\x61\144v\x61\156\143\x65\144\x69\156\166\145\x6eto\162y_\151\164\145\x6d");  $this->_tables["\x61i\163"] = Mage::getSingleton("\x63\157\162\145\x2fr\x65\x73ou\162c\x65")->getTableName("a\144v\141\x6ec\145d\151\x6ev\x65n\x74\x6f\x72y\137stoc\x6b");  $x47 = "S\x45LE\x43\124\x20\115\x41X\50id\51\x20A\x53\40\111\x4e\x43\40\106\x52\117\x4d\x20" . $this->_tables["\141\x69\x70"] . "\x20; ";  $x48 = $x46->fetchAll($x47);  $this->_autoInc = $x48[0]["I\x4e\103"];  Mage::$x77("\x2d\55\76\40M\x61\x78 \x69\156\x63r\145\155\145n\164\x20\x66ou\x6ed\x20#" . $x48[0]["I\x4e\103"] . "\50\101\x64\166\x61\156\x63\x65d\x20\x49n\166\x65n\x74\157\162y\x29", null, "\115\x61\163\x73\123t\157\x63k\125\160\141\x74\x65\x2e\154\157g");  } $x49 = array( "a\x63tivati\x6f\x6e\137k\x65\x79" => Mage::getStoreConfig("\155\141\163\163s\x74\157\x63k\165\160\144\x61\164\x65\57\x6cic\x65nse/\x61\143\164\151\x76a\164i\x6f\x6e\137\x6b\145y"), "\141\x63\164\x69\x76a\x74io\156\x5fc\157\144e" => Mage::getStoreConfig("\155\x61s\x73\163\164\x6f\143\x6b\x75p\144\141te\57\x6c\x69cen\x73e\57\141\x63\x74\x69v\141\x74\151o\x6e\137\143\157d\x65"), "\142\141\163\145\137\x75\162\x6c" => Mage::getStoreConfig("we\x62/\163\145c\x75r\x65\x2f\x62\x61\163\145\137\x75\162l"), );  $x34 = $x7a($this->getMapping());  foreach ($x34->columns as $x38 => $x4a) { if (!$x72($x4a->id, array("n\x6f\164-u\x73\145\x64", "\164\x6f\x74a\x6c", "i\x73\x5f\151\156_\163\x74\x6fc\153", "\x6d\x61n\141\147\x65\x5f\x6c\157c\x61\154\x5f\163\164\157c\153"))) { $this->_columns[] = $x4a->id;  } elseif ($x72($x4a->id, array("\164\x6f\x74a\x6c"))) { $this->_columns[] = "\164\x6f\x74a\x6c";  $this->_total = $x38 + 1;  } elseif ($x72($x4a->id, array("i\x73\x5f\151\156_\163\x74\x6fc\153"))) { $this->_columns[] = "i\x73\x5f\151\156_\163\x74\x6fc\153";  $this->_is_in_stock = $x38 + 1;  } elseif ($x72($x4a->id, array("\x6d\x61n\141\147\x65\x5f\x6c\157c\x61\154\x5f\163\164\157c\153"))) { $this->_columns[] = "\x6d\x61n\141\147\x65\x5f\x6c\157c\x61\154\x5f\163\164\157c\153";  $this->_manage_local_stock = $x38 + 1;  } else { $this->_columns[] = false;  } } Mage::$x77("\55->\x20C\x6f\x6c\165m\156\40\155\141p\x70ing \141n\x61\154y\172e\x64", null, "\115\x61\163\x73\123t\157\x63k\125\160\141\x74\x65\x2e\154\157g");  if ($x49[$x44["\x61\143"]] != $x44["\155\144"]($x44["\155\144"]($x49[$x44["\141k"]]) . $x44["\155\144"]($x49[$x44["\142\x75"]]) . $x44["\155\144"]($x44["\x65\x78t"]) . $x44["\155\144"]($x44["v\x65r"]))) { $$x44["\x65\x78t"] = "\166a\154i\144";  $$x44["\x74h"]->$x44["\x64\x6d"] = true;  } else { $$x44["\x74h"]->$x44["\x64\x6d"] = false;  $$x44["\x65\x78t"] = "\166a\154i\144";  } if (!isset($$x44["\x65\x78t"]) || $$x44["\x74h"]->$x44["\x64\x6d"]) { $$x44["\x74h"]->$x44["\x64\x6d"] = true;  return $$x44["\x74h"];  } Mage::$x77("\55\x2d\76\40\x50\162\145\160\141ri\156g\40\x4dy\123\161\154\x20q\x75\x65\162i\145\x73", null, "\115\x61\163\x73\123t\157\x63k\125\160\141\x74\x65\x2e\154\157g");  $x4b = $this->getSkuOffset() - 1;  $x4c = new Varien_Io_File();  $x4c->setAllowCreateFolders(true);  $x4d = Mage::getStoreConfig("ma\x73\163\163\164\157\143ku\x70\x64at\x65\57se\x74\x74i\x6e\x67\163\57\163ql\x5f\x66\151\x6c\x65");  $x4e = Mage::getStoreConfig("ma\163\163\x73t\157c\x6b\165p\x64a\164e\57se\164tin\x67\x73/\x73\161\x6c\137\144\x69\x72");  $x26 = $x25->getCleanPath(Mage::getBaseDir() . '/' . $x4e);  if (!$x4c->fileExists($x26, false)) { Mage::throwException(Mage::helper('massstockupdate')->__('Please create the specified folder "%s".', $x26));  } if (!$x4c->isWriteable($x26)) { Mage::throwException(Mage::helper('massstockupdate')->__('Please make sure that "%s" is writable by web-server.', $x26));  } $x4c->open(array('path' => $x4e));  $x4c->streamOpen($x4d, 'w');  if ($this->getAutoSetTotal() == 2) { $x4c->streamWrite("\x53\105T\40\146\x6f\x72\145\151\x67\156\137k\145\x79\137\x63\150\x65c\153\x73\x3d\60\x3b");  } if ($this->getFileType() === "\61") { $x4f = "\x3b";  $x50 = "\156o\x6e\145";  } else { $x4f = $this->getFileSeparator();  $x50 = $this->getFileEnclosure();  } if ($x50 != "\156o\x6e\145") { while (false !== ($x51 = $x25->streamReadCsv($x4f, $x50))) { $x52 = $x7b($x51, $x4b, 1);  $x7c($x51, $x52[0]);  $this->x87($x51);  foreach ($this->_sql as $x47) { $x4c->streamWrite($x76(array("\x0a", "\x20\40"), array("\x20", ""), $x75($x47)) . "\x0a");  } } } else { while (false !== ($x51 = $x25->streamReadCsv($x4f))) { $x52 = $x7b($x51, $x4b, 1);  $x7c($x51, $x52[0]);  $this->x87($x51);  foreach ($this->_sql as $x47) { $x4c->streamWrite($x76(array("\x0a", "\x20\40"), array("\x20", "\x20"), $x75($x47)) . "\x0a");  } } } Mage::$x77("--\x3e\x20\x46\151\x6ce\40\x63\x6co\163\145\x64\x20\x3a\x20" . $x26 . $x4d, null, "\115\x61\163\x73\123t\157\x63k\125\160\141\x74\x65\x2e\154\157g");  $x25->streamClose();  if ($this->getAutoSetTotal() == 2) { } $x4c->streamClose();  if ($x7d($this->_warnings)) Mage::getSingleton("c\x6f\162\145\57s\x65s\163\151o\156")->addError($x73("\74\x62\x72\76", ($this->_warnings)));  if (Mage::getStoreConfig("\x6da\163\x73st\157ck\165pda\164e\57s\x65t\x74\x69\x6eg\163\57s\x68\x5f\x6d\157d\145")) { return true;  } $x53 = Mage::getSingleton("\x63\157\162\145\x2fr\x65\x73ou\162c\x65")->getConnection("\143o\x72\145\137\x77ri\x74\145");  $x53->beginTransaction();  $x54 = true;
 Mage::$x77("\x2d->\40\x45\x78\x65\143\165\x74\x69\156\x67\40\115\x79\x53\x71l \161\x75\145\162i\x65s", null, "\115\x61\163\x73\123t\157\x63k\125\160\141\x74\x65\x2e\154\157g");  $x25 = new Varien_Io_File();  $x25->streamOpen($x26 . $x4d, "r");  while (false !== ($x47 = $x25->streamRead(102400))) { try { $x53->exec($x47);  } catch (Mage_Core_Exception $x30) { Mage::$x77("\x20\x66\x61il\145d\40\x2d\55>" . $x47, null, "\115\x61\163\x73\123t\157\x63k\125\160\141\x74\x65\x2e\154\157g");  $x54 = false;  } catch (Exception $x30) { Mage::$x77("\x20\x66\x61il\145d\40\x2d\55>" . $x47, null, "\115\x61\163\x73\123t\157\x63k\125\160\141\x74\x65\x2e\154\157g");  Mage::getSingleton("c\x6f\162\145\57s\x65s\163\151o\156")->addError($x30->getMessage());  $x54 = false;  } } if (!$x54) { Mage::$x77("-\x2d\x3e\40M\x79Sq\154\x20R\157\x6cl\x62\x61\143\x6b", null, "\115\x61\163\x73\123t\157\x63k\125\160\141\x74\x65\x2e\154\157g");  Mage::getSingleton("c\x6f\162\145\57s\x65s\163\151o\156")->addError(Mage::helper("ma\163s\x73t\x6f\x63\x6b\165\x70d\141\x74\x65")->__("\x45r\162\157r \167\150\x69\154\145\40\x70\162\x6f\143es\x73\x69ng.\40R\157\154\x6c\142\141\x63\153\x20\150ap\x70\145\x6e\x65d."));  $x53->rollback();  return false;  } else { Mage::$x77("--\x3e\x20\115\x79Sq\x6c\40\103\x6fm\155i\164", null, "\115\x61\163\x73\123t\157\x63k\125\160\141\x74\x65\x2e\154\157g");  $x53->commit();  $this->setImportedAt(Mage::getSingleton("\143\x6f\162\145\x2fda\164e")->gmtDate("Y\x2d\155\x2dd \x48:\151\72\x73"));  $this->save();  $x55 = Mage::getSingleton('index/indexer')->getProcessByCode('cataloginventory_stock');  $x55->reindexAll();  Mage::$x77("\x2d\55\76\40S\x74\x6fck\x20\x72\145\55\151n\144\x65x\x65\x64", null, "\115\x61\163\x73\123t\157\x63k\125\160\141\x74\x65\x2e\154\157g");  $x25->open(array('path' => $x4e));  $x25->rm($x4d);  return true;  } } private function x87($x56) { $x6d="in\x69_\x73\145t";  $x6e="stri\163\x74\162";  $x6f="\x69\x73\137\162\x65\x61d\141\x62\154\145";  $x70="t\x69\155\145";  $x71="fi\x6c\145\x5f\x67et\x5fc\157n\164\x65\x6et\163";  $x72="\x69\156_\141\162\162\x61\171";  $x73="\x69\155\160\x6c\x6f\x64\x65";  $x74="\x61\x72r\x61\171_k\145\171\137\145xist\x73";  $x75="\x74\x72im";  $x76="s\164r\137r\145p\x6cac\145";  $x77="l\x6f\x67";  $x78="\x69\163\x5fa\x72\162\141y";  $x79="\152\x73o\x6e\x5fe\156\x63o\x64\145";  $x7a="\152\163\157\x6e\x5f\144e\x63od\x65";  $x7b="\x61rr\x61y\x5f\163\x70li\x63e";  $x7c="\x61\x72r\141\171\137\165n\x73h\151\x66\x74";  $x7d="c\x6f\x75\156\x74";  $x7e="\151s_\156\x75\155\145\162\151\143";  $x7f="\141r\x72a\x79_\x70\165\x73h";  $x80="\163\164rtol\157w\x65\x72";  $x81="\x73\164\x72st\x72";  $x82="\x65\170plo\x64\145";  $x83="a\x64\144s\x6c\x61\x73h\145\163";  $this->_sql = array();  foreach ($x56 as $x57 => $x58) $x56[$x57] = $x75($x58);  if ($this->getUseCustomRules()) { $x59 = $this->getCustomRules();  eval($x76('$C[', '$x56[', $x59));  } $x5a = array();  $x5b = array();  $x40 = $this->getIdentifierCode() ? $this->getIdentifierCode() : "s\153\165";  $x5c = Mage::getModel('eav/config')->getAttribute(Mage_Catalog_Model_Product::ENTITY, $x40)->getFrontendLabel();  if (isset($this->_products[$x56[0]])) { $x5d = $this->_products[$x56[0]];  if (isset($this->_stocks[$x5d])) { $x5e = $this->_stocks[$x5d];  } else { $this->_autoInc++;  $x5e = $this->_autoInc ;  } $x5a["\x49\x44"] = $x5d;  $x5f = true;  $x5a["sta\164\x75\163"] = $x5f;  $x5a["\164\x6f\x74a\x6c"] = 0;  $x5a["i\x6e_\163\x74oc\x6b"] = null;  $x60 = 0;  foreach ($x56 as $x38 => $x39) { if (isset($this->_columns[$x38 - 1]) && $x38 > 0) { if (!$this->_total) { if ($x7e($x39) && $x5f) { if ($this->_columns[$x38 - 1] != "\164\x6f\x74a\x6c" && $this->_columns[$x38 - 1] != "i\x73\x5f\151\156_\163\x74\x6fc\153" && ($this->_columns[$x38 - 1] == "\165\163ed" || $x7e($this->_columns[$x38 - 1]))) $x5a["\164\x6f\x74a\x6c"]+=$x39;  $x5f = true;  } } else { if ($this->_total && $this->_columns[$x38 - 1] == "\164\x6f\x74a\x6c") { $x5a["\164\x6f\x74a\x6c"] = $x39;  if ($x7e($x39)) $x5f = true;  else $x5f = false;  } } if (Mage::helper("\143or\145")->isModuleEnabled("\x57\x79om\x69\156d_\x41\144v\x61\x6ece\x64\151n\x76\x65\156\x74\x6fr\171") && $x5f) { if ($x7e($x39) && $x7e($this->_columns[$x38 - 1])) { $x61 = "\40\x52E\x50\114A\x43E\x20\x49\116\x54\x4f \140" . $this->_tables["\x61i\163"] . "\x60\40\x28`\151d\140\54 \x60\x6co\143\141l\x73t\157c\x6b\x5f\x69\x64\140\x2c\140\160l\141\x63\x65_i\144`\54\x60\161\x75\x61\156\x74\x69\x74y\x5f\151n\137\x73t\157\143\x6b\x60,\140\160\162\x6fd\165c\164_\151d\x60,`\142\141\x63\153\157r\144e\162_\x61\x6c\x6co\167\145\144`,\x60u\163e\137\x63\157\x6e\x66ig\x5f\x73\145\x74t\x69n\x67_\x66\x6f\x72\137\142\x61ck\157r\144er\x73\140\51\x20\x76\141\x6cu\145\x73\x28 \12 \x20\x20 \40\40 \x20 \x20 \40 \x20\40\40\x20 \40\x20\x20 \x20\40\x20\x20\40\40\x20\x20 \40\x20\x20I\x46\x28\50\x53\x45\x4cE\x43\x54\x20\143\157\x75\156\x74\x28`\x69\144\140\x29\40FRO\x4d\40\140" . $this->_tables["\x61i\163"] . "\x60 A\x53\x20\x61 \x57\110\x45R\x45\x20\x60\160\154a\143e\137i\144\x60\75" . $this->_columns[$x38 - 1] . "\40\x41\x4eD\x20 \x60\160\162\x6f\144u\143\x74\x5fi\144`=" . $x5d . "\51\x3d\61\x2c\x28\x53EL\105\103\x54\40\x60id\x60\40\x46RO\115\40" . $this->_tables["\x61i\163"] . "\40\x41\x53\x20\141\x20\x57H\x45\122E\x20\x60p\154a\x63e_id`\x3d" . $this->_columns[$x38 - 1] . " A\x4e\x44\x20\x60p\162\157du\143\164_i\144`\x3d" . $x5d . "),NULL) ,$x5e," . $this->_columns[$x38 - 1] . ",$x39,$x5d,IFNULL((SELECT `backorder_allowed` FROM `" . $this->_tables["\x61i\163"] . "\x60\40\x41\x53\40`b\x60 \x57H\105\122E\40\140p\x6cace\137\x69\144\x60\75" . $this->_columns[$x38 - 1] . " A\x4e\x44\x20\x60p\162\157du\143\164_i\144`\x3d" . $x5d . ")\54\60\51\54\111\x46\x4eU\114L\x28\x28\x53\105LE\x43\x54 \x60\x75\163\145\137\143o\x6e\x66i\x67_\x73\145\x74\164i\156g_\x66o\x72\x5f\x62\141\x63ko\x72de\162\163\140 F\122\x4fM\x20\x60" . $this->_tables["\x61i\163"] . "` \101\123 \140\143\140\40\127\110\x45R\105 `\x70l\x61\143\145\x5f\x69d\x60\x3d" . $this->_columns[$x38 - 1] . " A\x4e\x44\x20\x60p\162\157du\143\164_i\144`\x3d" . $x5d . "\51\54\61\51\51\73";  $x7f($this->_sql, $x61);  $x5b[] = "-\x49FN\125L\x4c((\123\x45\x4cEC\124\40\140\161uan\x74ity\137\x69\156_st\157\x63\153\140 \106\122\117\x4d\x20`" . $this->_tables["\x61i\163"] . "`\40W\x48\x45R\x45\40\140p\154a\x63e_i\144\140\x3d" . $this->_columns[$x38 - 1] . "\40\x41\x4eD\x20 \x60\160\162\x6f\144u\143\x74\x5fi\144`=" . $x5d . "\x20\x29,\60\x29";  } } if (!$this->getAutoSetInstock()) { if ($this->_is_in_stock && $this->_columns[$x38 - 1] == "i\x73\x5f\151\156_\163\x74\x6fc\153") { if ($x72($x80($x39), array("\61", "tr\165\145", "\171e\x73", "\157\x6e", "\151\156 \x73\164o\143\153", "\151\x6es\x74\157\143\x6b", "\141va\151\x6c\141\x62l\x65"))) $x5a["i\x6e_\163\x74oc\x6b"] = true;  else $x5a["i\x6e_\163\x74oc\x6b"] = false;  } } else { if ($x5a["\164\x6f\x74a\x6c"] > 0) $x5a["i\x6e_\163\x74oc\x6b"] = true;  else $x5a["i\x6e_\163\x74oc\x6b"] = false;  } if ($this->_manage_local_stock && $this->_columns[$x38 - 1] == "\x6d\x61n\141\147\x65\x5f\x6c\157c\x61\154\x5f\163\164\157c\153") { if ($x72($x80($x39), array("\61", "tr\165\145", "\171e\x73", "\157\x6e", "\151\156 \x73\164o\143\153", "\151\x6es\x74\157\143\x6b", "\141va\151\x6c\141\x62l\x65"))) $x5a["\x6d\x61n\141\147\x65\x5f\x6c\157c\x61\154\x5f\163\164\157c\153"] = 1;  else $x5a["\x6d\x61n\141\147\x65\x5f\x6c\157c\x61\154\x5f\163\164\157c\153"] = 0;  } else { $x5a["\x6d\x61n\141\147\x65\x5f\x6c\157c\x61\154\x5f\163\164\157c\153"] = 1;  } if ($x81($this->_columns[$x38 - 1], "a\x74\164\x72\151bu\x74\145")) { $x62 = ($x82('-', $this->_columns[$x38 - 1]));  $x63 = Mage::getSingleton("\x63\157\162\145\x2fr\x65\x73ou\162c\x65")->getTableName("c\x61\x74\x61\154\x6fg_\160\162\x6fdu\143\164\137e\x6e\164i\164y\137" . $x62[3]);  $x61 = "UPDATE `$x63` SET `value`='" . $x83($x39) . "\47\x20\127HER\105 \140ent\x69\x74\171\x5f\151\x64\x60\75'" . $x5d . "'\x20\x41N\x44 \140\141\164t\x72i\142\x75\164\x65\137\151d\x60\75'" . $x62[2] . "\47\73";  $x7f($this->_sql, $x61);  } $x5a[$x60]["\x76\141\x6c\165e"] = $x39;  $x5a[$x60]["\143\x6fde"] = $this->_columns[$x38 - 1];  $x60++;  } };  $x5a["sta\164\x75\163"] = $x5f;  $x64 = $x5a["\164\x6f\x74a\x6c"];  if ($this->getAutoSetTotal() == 2) { if ($x7d($x5b)) $x64 = '(SELECT (IFNULL(SUM(`quantity_in_stock`),0)' . $x73('', $x5b) . "+$x64) FROM " . $this->_tables["\x61i\163"] . " WHERE `product_id`=$x5d)";  else { $x5f = false;  } } $x65 = $x5a["i\x6e_\163\x74oc\x6b"];  if (Mage::helper("\143or\145")->isModuleEnabled("\x57\x79om\x69\156d_\x41\144v\x61\x6ece\x64\151n\x76\x65\156\x74\x6fr\171")) { if ($x5f) { $x61 = "RE\x50\x4cA\x43\x45\40\x49\x4eTO \x60" . $this->_tables["\141\x69\x70"] . "` values($x5e,$x5d," . $x5a["\x6d\x61n\141\147\x65\x5f\x6c\157c\x61\154\x5f\163\164\157c\153"] . ")\73";  $x7c($this->_sql, $x61);  } } if (($x5f)) { if ($x65 === true || $x65 === false) { $x66 = "\x2c\40`\151\163\137\x69\156_\163\164o\143\153\x60";  $x67 = ($x65) ? '=1' : '=0';  if ($this->getAutoSetTotal() == 2) { $x67 = "= IF ($x64>0,1,0)";  } } else { $x66 = null;  $x67 = null;  } $x61 = "\x55\120D\x41\x54\105\x20`" . $this->_tables["\143\163\151"] . "\x60 \123\x45\x54\40" . " `product_id`='$x5d'," . " `qty`=$x64," . "\40`s\x74\157ck\x5f\151\x64\x60= \61" . " $x66 $x67 WHERE `product_id`='$x5d';
";  $x7c($this->_sql, $x61);  } if ($x5f) { $this->_notices[] = "$x5c <i>$x56[0]</i> has been updated";  } else { Mage::$x77("\x2a\x20\x50\x72\x6f\x64\165\143t\40#" . $x56[0] . "\40h\141s b\145\145n\40\151\x67\156\x6f\162e\144\40d\x75\145 \x74\157\x20\x73\x6f\155\x65 \x6eo\156 \143\157n\x73i\163\164\145nt\40\144\141ta\x2e", null, "\115\x61\163\x73\123t\157\x63k\125\160\141\x74\x65\x2e\154\157g");  $this->_warnings[] = "$x5c <i>$x56[0]</i> has been ignored due to some non consistent data.";  } $this->_output[] = $x5a;  } else { Mage::$x77("\x2a\x20\x50\x72\x6f\x64\165\143t\40#" . $x56[0] . " \x64o\145\x73\x6e'\164\40\x65\170\151\163t.\x20Pr\157du\143\164\40\x68as\x20b\145\x65n\40\x69\x67n\x6fr\145d\x2e", null, "\115\x61\163\x73\123t\157\x63k\125\160\141\x74\x65\x2e\154\157g");  $this->_warnings[] = "$x5c <i>$x56[0]</i> doesn't exist. Product has been ignored.";  } } function backup() { $x6d="i\x6e\151\137s\x65t";  $x6e="\x73\x74\x72\x69\x73\x74\x72";  $x6f="\151\163_\x72\145\x61d\141\x62\154\x65";  $x70="\164i\155\145";  $x71="\x66\x69\x6c\145\137\147\x65t\x5f\x63\x6f\156\164\x65n\164s";  $x72="\151\156\x5fa\162r\x61\171";  $x73="\151\155\x70\x6c\x6f\144\145";  $x74="\x61\162r\141\x79\x5f\x6b\x65\171\137ex\151s\x74\x73";  $x75="\x74\162\x69m";  $x76="\x73\x74\x72_rep\x6ca\x63\145";  $x77="l\157\147";  $x78="\151s\137\141rr\x61y";  $x79="\152\163\157n_\145\156\x63\157\144\145";  $x7a="j\x73\157\156\x5f\144\x65\x63o\x64e";  $x7b="\x61\162\162a\x79\137\163\x70\154\x69\143e";  $x7c="\x61\162\162\141y\x5fu\x6es\x68\151\146\x74";  $x7d="\x63\157\165\x6e\164";  $x7e="\151\x73_n\x75m\145ric";  $x7f="a\162ra\x79\137\160u\163\150";  $x80="\x73\164\162tolo\167\x65r";  $x81="st\x72s\164\162";  $x82="e\x78\x70\154od\x65";  $x83="ad\x64\x73\x6c\x61sh\x65\163";  $x47 = array();  $x68 = array();  $x69 = array();  $x45 = Mage::getSingleton("\x63\157\162\145\x2fr\x65\x73ou\162c\x65");  $x46 = $x45->getConnection("\x63\157\x72e\x5fr\145\141d");  $this->_tables["\143\163\151"] = Mage::getSingleton("\x63\157\162\145\x2fr\x65\x73ou\162c\x65")->getTableName("\143\141\164a\154\157\x67\x69nv\145n\164o\162\x79\x5f\x73\x74\157ck_\x69\164\x65m");  $this->_tables["c\160e"] = Mage::getSingleton("\x63\157\162\145\x2fr\x65\x73ou\162c\x65")->getTableName("\x63\141ta\154\157g_\160r\157\144\165\143\164\x5fe\x6e\x74\x69\x74\171");  $x7f($x47, "\114\x45F\124 JOI\x4e \x60" . $this->_tables["c\160e"] . "\140\40\101\x53\40`cp\145\x60\x20\x4f\116\40\140c\x70e`\x2e\140en\x74\151\x74y\137\x69\144\x60=\x60\143s\151\140\56\x60p\162\157\x64\x75c\164_i\144`");  if (Mage::helper("\143or\145")->isModuleEnabled("\x57\x79om\x69\156d_\x41\144v\x61\x6ece\x64\151n\x76\x65\156\x74\x6fr\171")) { $x68[] = null;  $x69[] = null;  $this->_tables["\x61i\163"] = Mage::getSingleton("\x63\157\162\145\x2fr\x65\x73ou\162c\x65")->getTableName("a\144v\141\x6ec\145d\151\x6ev\x65n\x74\x6f\x72y\137stoc\x6b");  $x6a = Mage::getModel("\160o\151n\x74\x6ff\x73al\x65\57\x70oi\x6e\x74\157\146\x73\x61\154e")->getPlaces();  foreach ($x6a as $x41) { $x7f($x47, "\114\x45F\124 JOI\x4e \x60" . $this->_tables["\x61i\163"] . "` \x41\123\x20`ai\137" . $x41->getPlaceId() . "\x60\x20\x4f\116\x20\x60\x61i\137" . $x41->getPlaceId() . "`\56\140\160\x72\157d\165\x63\x74\x5fi\144`\75`\143\160\145\140\56\x60\145\156\x74\x69\164\171\x5f\151d\x60 \x41\116\x44\40\140\141i\137" . $x41->getPlaceId() . "`\56\x60p\x6ca\143\145\137i\x64\140\x3d" . $x41->getPlaceId() . "");  $x68[] = "\141i\x5f" . $x41->getPlaceId() . "\x2e\x60\161\165\x61\156\164\151\x74y\x5f\151\156_s\x74\x6f\x63\x6b\x60 \101S\x20\140\x61i_\163\164\x6f\143k_" . $x41->getPlaceId() . "\x60";  } } $x7c($x47, "S\105\114\x45\103\x54\x20 \140\x63pe\x60.\x60\163\153u\140 " . $x73(', ', $x68) . "\x2c\40\140\x63\x73\x69\x60.`qty\x60\54\x60\143\163\151\140\x2e\140\x69\x73\137\x69\x6e\x5fs\x74\157\143\153\x60\x20\106\x52\117\115 \140" . $this->_tables["\143\163\151"] . "\140 \101\x53\40`\143s\x69`");  $x7f($x47, "\x57\110E\122E \140\x73\x6bu\x60\40\x49\123 \116\x4f\124 \116\125\114\114 " . $x73("\40A\116\x44 ", $x69) . "");  Mage::$x77("---\x2d-\x2d\x2d\55\55\x2d-\55\55\x2d\55-\x2d\x2d\x2d\55\x20\102\x41\103\x4b\x55\x50\x20P\x52O\103ESS\40--\x2d\55\x2d-\x2d\55-\55\55\x2d-\55\55-\x2d\55\55\x2d", null, "\115\x61\163\x73\123t\157\x63k\125\160\141\x74\x65\x2e\154\157g");  Mage::$x77("-\x2d\x2d\x3e\x20My\123q\x6c\x20\162\x65qu\145\x73t :\40" . $x73(' ', $x47), null, "\115\x61\163\x73\123t\157\x63k\125\160\141\x74\x65\x2e\154\157g");  $x56 = $x46->fetchAll($x73("\x20", $x47));  $x25 = new Varien_Io_File();  $x25->setAllowCreateFolders(true);  $x31 = Mage::getStoreConfig("\155\x61\x73s\x73\x74\157\x63k\x75\x70\x64a\164e\x2fset\164\x69\x6eg\163\x2f\x62a\x63ku\x70\x5ff\151\x6ce") . "\55" . $x70() . "\x2ec\163\x76";  $x6b = Mage::getStoreConfig("\155a\163s\163\164o\143\153\165\160\144\x61te\57\163\x65\x74\x74\x69\156\x67s/\x62\x61\x63\153up_\144\151r");  $x25->open(array("p\x61t\150" => Mage::getBaseDir() . "\x2f" . $x6b));  if ($x25->fileExists($x31) && !$x25->isWriteable($x31)) { Mage::throwException(Mage::helper("\x6f\x72\x64\145r\x73e\170\x70\x6fr\164t\x6f\x6f\154")->__("\x46\151l\145\x20'\x25s\x27\x20\143\141n\x6e\x6f\x74\x20\142\145\x20\163\141ved\56\40\120\154e\x61s\145,\x20\155\141\153\145 \163\x75\x72\x65\x20\164\150\x65 d\151\x72\x65\x63\x74\x6fr\171\40\x25\163' i\163\x20\167\x72\151te\x61b\x6c\145 \142y\x20\x77\145\142\40serv\145\x72\56", $x31, $this->getPath()));  } $x25->streamOpen($x31, "w");  foreach ($x56 as $x6c) { $x25->streamWriteCsv($x6c, "\x3b");  } $x25->streamClose();  Mage::getSingleton("c\x6f\162\145\57s\x65s\163\151o\156")->addSuccess(Mage::helper("ma\163s\x73t\x6f\x63\x6b\165\x70d\141\x74\x65")->__("\x42\141\x63kup\x20c\162\x65\141te\144\x20\x3a\40\x20\x20'%s\47.", $x6b . $x31));  Mage::$x77("-\55\x2d>\40\x44\x4fNE\x20: " . $x6b . $x31, null, "\115\x61\163\x73\123t\157\x63k\125\160\141\x74\x65\x2e\154\157g");  return;  } } ; 
