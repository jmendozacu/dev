<?php ini_set('memory_limit', "\61\60\62\64\60\x4d");
 class Wyomind_Massstockupdate_Model_Import extends Mage_Core_Model_Abstract { public $_warnings = array();  public $_notices = array();  public $_sql = array();  public $_columns = array();  public $_products = array();  public $_stocks = array();  public $_autoInc = 0;  public $_tables = array();  public $_total = false;  public $_is_in_stock = false;  public $x2f = false;  public $_output = array();  public $x30 = array();  public function _construct() { $x7a="\x73\x74r\x69st\162";  $x7b="\x69s\x5frea\144a\142\154e";  $x7c="t\x69\155\145";  $x7d="\146\151l\145_g\x65\x74_\143\x6fn\164e\156\x74\x73";  $x7e="\x69\156_\x61\x72\x72ay";  $x7f="i\155\160l\x6f\x64\145";  $x80="arr\141\171\x5fk\145\171_\145\x78is\164s";  $x81="\x74ri\x6d";  $x82="\x73\x74\x72_re\x70la\x63\x65";  $x83="\154\x6f\x67";  $x84="\x69s\137a\162\x72\141y";  $x85="\152\x73\157n\x5fenc\x6fde";  $x86="\x6a\163on_de\x63\x6f\144\145";  $x87="\x61\162\x72a\x79\137\x73p\154\151\x63e";  $x88="\141\x72r\x61\x79_\x75nshift";  $x89="\143ou\156\x74";  $x8a="\151s\137n\165m\145\162\151c";  $x8b="\x61\162\162\141y\x5fpu\x73\x68";  $x8c="\163tr\164o\154o\167\145\x72";  $x8d="s\x74r\x73t\162";  $x8e="e\x78\x70\154o\144\x65";  $x8f="\141ddsl\141s\x68\x65s";  parent::_construct();  $this->_init("\155\141s\163\x73\x74ock\x75\x70\144\x61te\57\151\x6dp\x6f\162\164");  } protected function _beforeSave() { $x7a="s\164r\151\163\x74\x72";  $x7b="\151\x73\x5f\162\x65a\x64\x61b\154\145";  $x7c="tim\x65";  $x7d="f\151l\145\x5fge\164\137\143o\x6e\x74\145\156\x74s";  $x7e="\151\156\137a\x72\162a\x79";  $x7f="\x69\155pl\x6f\x64\145";  $x80="a\x72\x72ay_\x6b\x65\171\x5f\145\170\151st\163";  $x81="\164\162\x69\x6d";  $x82="\163tr_r\145p\154ac\x65";  $x83="\154o\147";  $x84="\151\163\x5f\141rra\x79";  $x85="\152\163\x6f\156\x5f\145n\x63\157\144e";  $x86="\152\x73o\x6e\x5f\144ec\157\144e";  $x87="ar\162\x61\171\x5f\x73\160\154\151ce";  $x88="ar\x72\141\x79_u\x6e\163\x68if\x74";  $x89="\x63oun\x74";  $x8a="is\x5f\x6e\x75\155\145\x72i\x63";  $x8b="\141rr\141y\x5f\x70u\x73h";  $x8c="\x73t\x72\x74o\x6c\x6f\167\x65\x72";  $x8d="strs\x74\x72";  $x8e="\x65x\x70\x6cod\x65";  $x8f="a\x64ds\x6ca\x73\x68e\x73";  if ($this->getFileSystemType() !== "\61") { $x31 = new Varien_Io_File();  $x32 = $x31->getCleanPath(Mage::getBaseDir() . "\x2f" . $this->getFilePath());  if (!$x31->fileExists($x32, false)) { Mage::throwException(Mage::helper("m\x61\x73\x73s\164ock\x75\160\144\141t\x65")->__("\127\162\157ng\40\146\151\x6ce\40p\x61\x74\x68. \47%\x73\x27\x20i\x73\x20\x6eo\164\40\141 \x66i\x6ce\56", $x32));  } if ($x7a($this->getFilePath(), ".\x63\x73v") < 0) { Mage::throwException(Mage::helper("m\x61\x73\x73s\164ock\x75\160\144\141t\x65")->__("Wr\x6f\156\147\40\146\151\154\145\56\x20\x27%\x73\x27\x20\x69\163\40\x6e\x6f\164 \141\x20csv\40\x66i\x6c\x65\56", $x32));  } if (!$x7b($x32)) { Mage::throwException(Mage::helper("m\x61\x73\x73s\164ock\x75\160\144\141t\x65")->__("Pl\x65\x61se\x20\155\141\x6b\x65\40\x73\165r\145\x20t\150\141\x74 \x27\45\163\47 i\x73\40\x72\x65\141\x64\x61\x62\x6c\145 \142y \x77e\x62\x2d\163\145r\x76er.", $x32));  } } return parent::_beforeSave();  } public function x90() { $x7a="\x73tr\151\x73\x74\162";  $x7b="\151s\x5f\162\145\141\144a\x62\154\x65";  $x7c="t\151\x6de";  $x7d="fil\x65_g\145\164_\143\157\156t\145n\164s";  $x7e="\151n\137\x61\x72r\x61\x79";  $x7f="\151\155\x70l\157\x64e";  $x80="\141rr\x61\171\x5fk\145y\x5f\x65xis\x74s";  $x81="\164r\x69\155";  $x82="\x73tr\x5f\162\x65\160\x6ca\143\x65";  $x83="\x6c\157g";  $x84="\151\x73\x5f\x61\162\x72\141\171";  $x85="j\x73\157\x6e_e\x6e\x63\157\x64e";  $x86="\x6a\163\x6f\156\x5f\144\x65co\144\x65";  $x87="\141r\x72a\x79\137\x73\160\x6cic\145";  $x88="\x61r\162\x61y_\x75n\x73\150\x69f\164";  $x89="c\x6f\x75\156\164";  $x8a="\151\x73\x5f\156\x75\155\x65\x72\x69\x63";  $x8b="\x61rr\x61y\137\160\165\163h";  $x8c="\163t\x72\164\157l\157\167\x65r";  $x8d="s\164\x72\x73\x74\x72";  $x8e="e\x78\160l\157\144\145";  $x8f="\x61d\x64\163\x6ca\x73h\x65s";  $this->_warnings = array();  $this->_notices = array();  $this->_sql = array();  $this->_columns = array();  $this->_products = array();  $this->_stocks = array();  $this->_autoInc = 0;  $this->_tables = array();  $this->_total = false;  $this->_output = array();  } private function x91() { $x7a="\x73t\x72\x69\163t\162";  $x7b="\151s\x5f\162\x65\x61da\x62\x6c\145";  $x7c="\164i\x6de";
 $x7d="\146\151\154e\137\147et\137\x63on\x74\x65\156t\163";  $x7e="\x69n\x5f\x61\x72r\x61\x79";  $x7f="\x69\155plod\x65";  $x80="\x61\162\x72a\x79_\153\145y\x5f\x65\x78\151sts";  $x81="tri\x6d";  $x82="st\x72\x5fre\x70\154\141\x63e";  $x83="l\157g";  $x84="\151s_\x61\162\162\141\171";  $x85="js\157n_\145n\143\157\144\145";  $x86="js\x6f\156\x5fd\x65\x63\157\x64e";  $x87="\141r\162\x61y_s\x70\154i\x63e";  $x88="\141r\x72\x61\171_unshi\146t";  $x89="c\157u\156\164";  $x8a="\151s\x5f\x6e\x75\x6d\x65\x72\151\143";  $x8b="ar\162\141\171_pus\150";  $x8c="\163\164\162\164o\x6c\157\167er";  $x8d="\x73\164\162\163tr";  $x8e="\145xp\x6c\x6f\144e";  $x8f="a\x64\x64sl\x61\163\150e\x73";  $x33 = $this->getFtpHost();  $x34 = $this->getFtpLogin();  $x35 = $this->getFtpPassword();  $x36 = $this->getFtpDir();  $x37 = $this->getUseSftp();  $x38 = $this->getFtpActive();  if ($x37) $x39 = new Varien_Io_Sftp();  else $x39 = new Varien_Io_Ftp();  try { $x39->open( array( 'host' => $x33, 'user' => $x34, 'username' => $x34, 'password' => $x35, 'timeout' => '120', 'path' => $x36, 'passive' => !($x38) ) );  if ($x39->cd($x36)) { $x3a = 'var/tmp/stock_import_' . $x7c() . '.csv';  $x31 = new Varien_Io_File();  $x32 = $x31->getCleanPath(Mage::getBaseDir() . '/var/tmp/');  if ($x7b($x32)) { $x3b = $x39->read($this->getFilePath(), $x3a);  $x39->close();  if (!$x3b) { return array("T\x68\x65\40\x66\x69le\x20'" . $this->getFilePath() . "\x27\40c\141\156\156\x6f\x74\x20\x62\x65\x20\146\x65\164\x63\x68\145d.");  } return $x3a;  } else { $x39->close();  return array("\120l\x65a\x73\x65\x20m\x61\153\145\x20s\165r\145 \x74ha\164 \x76\x61\x72\57\x74\x6d\x70 is\40\x77\162i\x74\141b\x6ce\x2e");  } } else { $x39->close();  return array("Cannot access '$x36' on this server.");  } } catch (Exception $x3c) { return $x3c->getMessage();  } } public function x92($x3d, $x3e) { $x7a="s\x74\x72i\163\164r";  $x7b="\151\163\137re\x61d\141b\154\145";  $x7c="\x74\x69\155\x65";  $x7d="\146il\x65_\147e\164\137\143o\156\164\145\x6e\164s";  $x7e="\151\x6e_\141\x72\162\x61\x79";  $x7f="\x69m\x70\154\x6f\x64e";  $x80="a\x72ra\171_\153\x65\171\x5fexis\164\163";  $x81="\164\162\151m";  $x82="s\x74\x72_\x72ep\154a\x63\145";  $x83="l\157\147";  $x84="\151\x73\x5fa\x72\162\x61y";  $x85="\152son\137\x65\156c\x6f\x64e";  $x86="\x6as\x6fn_de\x63\x6f\144\145";  $x87="\141\x72\162\141\x79_\x73\x70l\151c\145";  $x88="\x61\162\162a\x79_u\x6e\x73h\x69f\164";  $x89="\x63\157u\x6e\x74";  $x8a="\x69s\x5fn\x75\155\145\162\151\x63";  $x8b="a\162r\x61y\137p\x75\x73h";  $x8c="\163\x74\162\164\x6f\x6c\157wer";  $x8d="s\x74\162\x73tr";  $x8e="\145\170\x70\x6code";  $x8f="\141\x64\144sla\x73\150\x65\x73";  $x3f = new SimpleXMLElement($x7d($x3d));  $x3f = $x3f->xpath($x3e);  $x40 = array();  $x41 = array();  foreach ($x3f as $x42) { $x43 = array();  foreach ($x42 as $x44 => $x45) { if (!$x7e($x44, $x40)) { $x40[] = $x44;  } $x43[$x44] = (string) $x45;  } $x41[] = $x43;  } $x46 = $x7f("\73", $x40) . "\x0a";  $x47 = 0;  foreach ($x41 as $x42) { $x43 = array();  foreach ($x40 as $x48) { if ($x80($x48, $x42)) { $x43[] = $x81($x82("\x0a", "\40", $x42[$x48]));  } else { $x43[] = "";  } } $x46 .= $x7f("\73", $x43) . "\x0a";  } $x31 = new Varien_Io_File();  $x31->setAllowCreateFolders(true);  $x32 = $x31->getCleanPath(Mage::getBaseDir() . '/var/tmp/');  $x31->open(array('path' => $x32));  $x49 = "\155\163\165\137" . $x7c() . ".\x63\x73v";  if ($x31->isWriteable($x32)) { $x31->streamOpen($x32 . $x49, 'w');  $x31->streamWrite($x46);  $x31->streamClose();  return "\166\x61\x72\x2f\x74\x6d\160/" . $x49;  } else { return array("Cannot access '$x32' on this server.");  } } public function importProcess() { $x7a="\x73t\162\x69\163\x74\x72";  $x7b="\x69\x73\x5fr\x65\x61\144a\142l\x65";  $x7c="\164ime";  $x7d="f\151le\x5fg\145\164\x5f\143\x6f\156te\156t\x73";  $x7e="\151\x6e_a\x72\162ay";  $x7f="\x69\x6d\x70\x6code";  $x80="\x61r\162\141\171_\x6b\145\171\137e\x78\x69\163\x74\x73";  $x81="\x74\x72\x69\x6d";  $x82="\163\164\x72\x5fr\x65\160la\143\145";  $x83="\x6c\x6f\x67";  $x84="i\163_ar\x72\x61y";  $x85="\152\163\157\156_\145nc\157\x64\x65";  $x86="\152\163on_\144\145\x63\x6fd\x65";  $x87="\x61\162\162\x61\171\137\163p\154i\x63e";
 $x88="\141r\162\x61\171\x5f\165nshi\146\164";  $x89="\143ou\156t";  $x8a="is\x5f\156u\155\x65\162\151c";  $x8b="\x61\162\162a\171\x5f\x70\x75\x73\150";  $x8c="st\162t\x6fl\x6f\x77e\162";  $x8d="\x73t\162\x73\164\162";  $x8e="e\170p\x6c\x6fde";  $x8f="ad\144sl\141s\150\145s";  Mage::$x83("\x2d\x2d\55\x2d-\x2d\55\x2d--\x2d\x2d\55\x2d-\x2d\55\55-\55\x20IMPOR\x54A\x54\111O\116 \x50R\117\103\105S\123\x20-\55--\55-\55\x2d-\x2d\55\55-\x2d\x2d", null, "M\141\x73s\x53\x74\157c\x6b\x55\x70a\164\x65\x2e$x83");  $this->x90();  $x4a = $this->getFilePath();  if ($this->getFileSystemType() === "\61") { $x3b = $this->x91();  if ($x84($x3b)) { $x4b['status'] = 'error';  $x4b['body'] = $x3b[0];  die($x85($x4b));  } else { $x4a = $x3b;  } } $x31 = new Varien_Io_File();  $x32 = $x31->getCleanPath(Mage::getBaseDir() . "\x2f" . $x4a);  if ($this->getFileType() === "\61") { $x49 = $this->x92($x32, $this->getXpathToProduct());  if ($x84($x49)) { $x4b['status'] = 'error';  $x4b['body'] = $x49[0];  die($x85($x4b));  } $x32 = $x31->getCleanPath(Mage::getBaseDir() . '/' . $x49);  } $x31->streamOpen($x32, "\162");  Mage::$x83("\x2d-\76\40\106\151le\x20\x6f\x70\x65\156\145\x64\40\72\40" . $x32, null, "M\141\x73s\x53\x74\157c\x6b\x55\x70a\164\x65\x2e$x83");  $x4c = $this->getIdentifierCode() ? $this->getIdentifierCode() : "\163k\x75";  $x41 = Mage::getModel("ca\164a\x6cog/\160\x72\x6f\x64uct")->getCollection()->addAttributeToSelect($x4c);  foreach ($x41 as $x4d) { $this->_products[$x81($x4d->getData($x4c))] = $x4d->getId();  };  Mage::$x83("\x2d\55\76\x20\x50r\x6f\144\165\x63\164\163\x20c\x6f\154lec\164\x65\144", null, "M\141\x73s\x53\x74\157c\x6b\x55\x70a\164\x65\x2e$x83");  if (Mage::helper("\x63\157\x72\145")->isModuleEnabled("\127\171o\x6d\151n\144\137\101dv\141\156\x63\145di\156\166\145\x6e\164o\162\171")) { $x4e = Mage::getModel("\141\x64\166\x61\156\x63\145di\156\x76\145\x6et\x6f\x72\171\57st\x6fc\153")->getCollection();  foreach ($x4e as $x4f) { $this->_stocks[$x4f->getProductId()] = $x4f->getId();  };  Mage::$x83("\55\x2d\x3e \114o\x63\x61\154\40s\164oc\x6bs co\154le\143\x74\145d \x28Adv\141nc\x65\144\40\x49\156v\145\156\164\157\x72\171\x29", null, "M\141\x73s\x53\x74\157c\x6b\x55\x70a\164\x65\x2e$x83");  } $x50 = array("\141\143" => "\141c\x74\x69\166\141\164\x69o\x6e\x5f\143\x6f\x64\145", "\x61k" => "\x61c\x74\151\x76\141\164\x69\157n\x5f\153\145y", "b\165" => "\x62\x61se_u\162l", "\x6dd" => "m\x64\65", "\164\x68" => "\x74\150i\163", "d\x6d" => "\x5f\144\x65m\x6f", "\x65\x78t" => "m\x73\x69", "\x76\x65\x72" => "\63.\71.\62");  $x51 = Mage::getSingleton("\x63\x6f\162\x65\x2f\162\145sou\x72c\145");  $x52 = $x51->getConnection("\x63o\162e_\x72e\x61\144");  $this->_tables["c\x73\151"] = Mage::getSingleton("\x63\x6f\162\x65\x2f\162\145sou\x72c\145")->getTableName("cat\x61\154\x6f\147\x69\156\x76\x65n\x74\x6f\x72\x79\x5f\163t\x6f\143\x6b\x5fi\x74\x65\x6d");  if (Mage::helper("\x63\157\x72\145")->isModuleEnabled("\127\171o\x6d\151n\144\137\101dv\141\156\x63\145di\156\166\145\x6e\164o\162\171")) { $this->_tables["\x61i\x70"] = Mage::getSingleton("\x63\x6f\162\x65\x2f\162\145sou\x72c\145")->getTableName("\141d\x76\x61\156\143\x65di\156\166\x65\156\x74or\x79_\x69\x74\145m");  $this->_tables["a\151\163"] = Mage::getSingleton("\x63\x6f\162\x65\x2f\162\145sou\x72c\145")->getTableName("ad\x76\x61\x6e\143\x65\x64\x69\x6e\x76\x65\x6et\x6f\x72\x79_\x73t\x6fck");  $x53 = "\123E\114E\x43\124\x20M\x41\x58(\x69\x64\51\40\x41\123 \111N\x43\x20F\122\x4fM\40" . $this->_tables["\x61i\x70"] . "\x20\x3b";  $x54 = $x52->fetchAll($x53);  $this->_autoInc = $x54[0]["\x49\116\x43"];  Mage::$x83("\55-\76\x20\x4d\141\x78\x20\151ncr\145m\x65\x6e\x74\40\x66\157\165nd #" . $x54[0]["\x49\116\x43"] . "\x28\101\144\166\x61nc\x65\x64\x20\111nv\145n\x74\157r\171\51", null, "M\141\x73s\x53\x74\157c\x6b\x55\x70a\164\x65\x2e$x83");  } $x55 = array( "\x61c\x74\151\x76\141\164\x69\157n\x5f\153\145y" => Mage::getStoreConfig("\155as\163s\164\x6fc\x6bu\x70\144a\x74e/\x6cic\x65\x6e\163\x65\x2fa\143\164\x69\x76\x61ti\x6f\156\x5fke\x79"), "\141c\x74\x69\166\141\164\x69o\x6e\x5f\143\x6f\x64\145" => Mage::getStoreConfig("\155\x61\163s\163\164\x6fc\x6bupd\x61te\57\154i\143e\156\163\x65\x2f\x61\143\164\x69\x76\141tio\x6e\137\143od\145"), "\x62\x61se_u\162l" => Mage::getStoreConfig("\167\145\x62\x2fs\145\x63\x75\162e\57ba\x73e\137ur\x6c"), );  $x40 = $x86($this->getMapping());  foreach ($x40->columns as $x44 => $x56) { if (!$x7e($x56->id, array("\156ot-u\163\x65\144", "\164\x6ft\x61\154", "\x69\x73_\x69n_\x73\x74\157\143\x6b", "\155anage\x5f\x6c\157c\x61\x6c\137\163\164\x6f\143\153"))) { $this->_columns[] = $x56->id;  } elseif ($x7e($x56->id, array("\164\x6ft\x61\154"))) { $this->_columns[] = "\164\x6ft\x61\154";  $this->_total = $x44 + 1;  } elseif ($x7e($x56->id, array("\x69\x73_\x69n_\x73\x74\157\143\x6b"))) { $this->_columns[] = "\x69\x73_\x69n_\x73\x74\157\143\x6b";  $this->_is_in_stock = $x44 + 1;  } elseif ($x7e($x56->id, array("\155anage\x5f\x6c\157c\x61\x6c\137\163\164\x6f\143\153"))) { $this->_columns[] = "\155anage\x5f\x6c\157c\x61\x6c\137\163\164\x6f\143\153";  $this->_manage_local_stock = $x44 + 1;  } else { $this->_columns[] = false;  } } Mage::$x83("\55-\x3e \103\157\x6c\x75\155\156 \x6d\141\160\x70\x69\x6eg\40\x61\x6e\141l\171\x7a\145\144", null, "M\141\x73s\x53\x74\157c\x6b\x55\x70a\164\x65\x2e$x83");  if ($x55[$x50["\141\143"]] != $x50["\x6dd"]($x50["\x6dd"]($x55[$x50["\x61k"]]) . $x50["\x6dd"]($x55[$x50["b\165"]]) . $x50["\x6dd"]($x50["\x65\x78t"]) . $x50["\x6dd"]($x50["\x76\x65\x72"]))) { $$x50["\x65\x78t"] = "\x76\141\154\151\144";  $$x50["\164\x68"]->$x50["d\x6d"] = true;  } else { $$x50["\164\x68"]->$x50["d\x6d"] = false;  $$x50["\x65\x78t"] = "\x76\141\154\151\144";  } if (!isset($$x50["\x65\x78t"]) || $$x50["\164\x68"]->$x50["d\x6d"]) { $$x50["\164\x68"]->$x50["d\x6d"] = true;  return $$x50["\164\x68"];  } Mage::$x83("\55-\x3e \120\x72ep\141r\151ng\40M\171S\161\154 \161ue\162\151\145\x73", null, "M\141\x73s\x53\x74\157c\x6b\x55\x70a\164\x65\x2e$x83");  $x57 = $this->getSkuOffset() - 1;  $x58 = new Varien_Io_File();  $x58->setAllowCreateFolders(true);  $x59 = Mage::getStoreConfig("\x6d\141\x73sst\157c\153u\x70d\x61\x74\x65\57\x73\145t\x74\x69\156g\163/\163ql\x5ff\x69\154\145");  $x5a = Mage::getStoreConfig("\155\x61\163\163s\x74\x6f\143\153up\144\x61\x74e/s\x65t\x74i\156\x67\x73\x2f\x73\x71\x6c\137dir");  $x32 = $x31->getCleanPath(Mage::getBaseDir() . '/' . $x5a);  if (!$x58->fileExists($x32, false)) { Mage::throwException(Mage::helper('massstockupdate')->__('Please create the specified folder "%s".', $x32));  } if (!$x58->isWriteable($x32)) { Mage::throwException(Mage::helper('massstockupdate')->__('Please make sure that "%s" is writable by web-server.', $x32));  } $x58->open(array('path' => $x5a));  $x58->streamOpen($x59, 'w');  if ($this->getAutoSetTotal() == 2) { $x58->streamWrite("S\x45\x54 \146\x6f\162\x65\x69\x67n\x5f\x6b\145y\x5f\143h\145\143\x6b\163\75\60; ");  } if ($this->getFileType() === "\61") { $x5b = "\73";  $x5c = "n\x6f\156\145";  } else { $x5b = $this->getFileSeparator();  $x5c = $this->getFileEnclosure();  } if ($x5c != "n\x6f\156\145") { while (false !== ($x5d = $x31->streamReadCsv($x5b, $x5c))) { $x5e = $x87($x5d, $x57, 1);  $x88($x5d, $x5e[0]);  $this->x93($x5d);  foreach ($this->_sql as $x53) { $x58->streamWrite($x82(array("\x0a", "\x20\40"), array("\40", ""), $x81($x53)) . "\x0a");  } } } else { while (false !== ($x5d = $x31->streamReadCsv($x5b))) { $x5e = $x87($x5d, $x57, 1);  $x88($x5d, $x5e[0]);  $this->x93($x5d);  foreach ($this->_sql as $x53) { $x58->streamWrite($x82(array("\x0a", "\x20\40"), array("\40", "\40"), $x81($x53)) . "\x0a");  } } } Mage::$x83("\x2d\x2d> F\x69\x6ce\40\143\x6c\x6f\x73\145d\x20\x3a " . $x32 . $x59, null, "M\141\x73s\x53\x74\157c\x6b\x55\x70a\164\x65\x2e$x83");  $x31->streamClose();  if ($this->getAutoSetTotal() == 2) { } $x58->streamClose();  if ($x89($this->_warnings)) Mage::getSingleton("co\x72\x65\x2f\x73\145\163s\x69\157n")->addError($x7f("\x3c\x62r>", ($this->_warnings)));  if (Mage::getStoreConfig("\155\141\x73s\163toc\x6b\165\160\144\x61t\x65/s\x65\x74t\151\156\147\x73\57\x73\x68\137\x6do\144e")) { return true;  } $x5f = Mage::getSingleton("\x63\x6f\162\x65\x2f\162\145sou\x72c\145")->getConnection("\143\x6f\x72e\x5f\x77\x72\151\164\145");  $x5f->beginTransaction();  $x60 = true;  Mage::$x83("\x2d\55\76 E\170\145\143u\x74\x69ng \115\171Sql\x20\x71\x75\x65\x72i\145\x73", null, "M\141\x73s\x53\x74\157c\x6b\x55\x70a\164\x65\x2e$x83");  $x31 = new Varien_Io_File();  $x31->streamOpen($x32 . $x59, "\162");  while (false !== ($x53 = $x31->streamRead(102400))) { try { $x5f->exec($x53);  } catch (Mage_Core_Exception $x3c) { Mage::$x83(" \146\141i\154\145\x64 --\x3e" . $x53, null, "M\141\x73s\x53\x74\157c\x6b\x55\x70a\164\x65\x2e$x83");  $x60 = false;
 } catch (Exception $x3c) { Mage::$x83(" \146\141i\154\145\x64 --\x3e" . $x53, null, "M\141\x73s\x53\x74\157c\x6b\x55\x70a\164\x65\x2e$x83");  Mage::getSingleton("co\x72\x65\x2f\x73\145\163s\x69\157n")->addError($x3c->getMessage());  $x60 = false;  } } if (!$x60) { Mage::$x83("\x2d\x2d>\40\115y\123\x71\154 \122o\154lb\x61\x63k", null, "M\141\x73s\x53\x74\157c\x6b\x55\x70a\164\x65\x2e$x83");  Mage::getSingleton("co\x72\x65\x2f\x73\145\163s\x69\157n")->addError(Mage::helper("m\x61\x73\x73s\164ock\x75\160\144\141t\x65")->__("E\162r\x6f\162\40w\x68\x69\x6ce\x20\x70\x72\157\x63\x65\163\163\151n\147\56 R\x6f\x6c\154\x62ack\x20\150\x61ppe\x6e\x65\x64\x2e"));  $x5f->rollback();  return false;  } else { Mage::$x83("\x2d\x2d\x3e\40\115\x79\x53\x71l\x20\103\x6fm\x6d\151\x74", null, "M\141\x73s\x53\x74\157c\x6b\x55\x70a\164\x65\x2e$x83");  $x5f->commit();  $this->setImportedAt(Mage::getSingleton("c\x6f\162\x65\x2f\x64\141t\x65")->gmtDate("\x59\x2d\155\x2dd\x20\x48\x3a\151\x3a\x73"));  $this->save();  $x61 = Mage::getSingleton('index/indexer')->getProcessByCode('cataloginventory_stock');  $x61->reindexAll();  Mage::$x83("\x2d\x2d\x3e\40\123\164oc\153\40r\145-\151nd\145\x78e\144", null, "M\141\x73s\x53\x74\157c\x6b\x55\x70a\164\x65\x2e$x83");  $x31->open(array('path' => $x5a));  $x31->rm($x59);  return true;  } } private function x93($x62) { $x7a="s\x74\x72i\163\164\162";  $x7b="\x69\163\x5f\162e\141d\141\x62\154e";  $x7c="\164\151m\x65";  $x7d="\x66\151l\x65_g\145\164_\x63ont\x65\x6e\164\x73";  $x7e="i\156_\141\x72\162\x61\x79";  $x7f="\x69\x6dp\154ode";  $x80="\x61r\x72\x61y\137k\145y\137\x65\170i\163ts";  $x81="\x74\162i\155";  $x82="s\x74\162\x5f\x72epla\143e";  $x83="\x6c\157g";  $x84="\x69\x73\x5f\x61\162r\141y";  $x85="\152\x73\x6f\156\x5f\145n\x63\x6fd\x65";  $x86="js\157\156\137\144\x65c\x6f\x64\x65";  $x87="a\162\x72\x61\171_\x73\x70\154\151\143e";  $x88="ar\162ay\137\165\x6e\x73\x68\151\146\164";  $x89="co\165\x6e\x74";  $x8a="is\137\x6eu\x6der\x69\143";  $x8b="\141\162\162\141\171_\160\x75\x73h";  $x8c="\x73\164\x72tolow\145r";  $x8d="s\x74\162\x73\164\162";  $x8e="\145\170\160\154o\x64\x65";  $x8f="\141\144\144\x73la\163h\x65s";  $this->_sql = array();  foreach ($x62 as $x63 => $x64) $x62[$x63] = $x81($x64);  if ($this->getUseCustomRules()) { $x65 = $this->getCustomRules();  eval($x82('$C[', '$x62[', $x65));  } $x66 = array();  $x67 = array();  $x4c = $this->getIdentifierCode() ? $this->getIdentifierCode() : "\163k\x75";  $x68 = Mage::getModel('eav/config')->getAttribute(Mage_Catalog_Model_Product::ENTITY, $x4c)->getFrontendLabel();  if (isset($this->_products[$x62[0]])) { $x69 = $this->_products[$x62[0]];  if (isset($this->_stocks[$x69])) { $x6a = $this->_stocks[$x69];  } else { $this->_autoInc++;  $x6a = $this->_autoInc ;  } $x66["\111D"] = $x69;  $x6b = true;  $x66["\163\x74\141\164\165s"] = $x6b;  $x66["\164\x6ft\x61\154"] = 0;  $x66["in\137s\164\157ck"] = null;  $x6c = 0;  foreach ($x62 as $x44 => $x45) { if (isset($this->_columns[$x44 - 1]) && $x44 > 0) { if (!$this->_total) { if ($x8a($x45) && $x6b) { if ($this->_columns[$x44 - 1] != "\164\x6ft\x61\154" && $this->_columns[$x44 - 1] != "\x69\x73_\x69n_\x73\x74\157\143\x6b" && ($this->_columns[$x44 - 1] == "\165s\x65\144" || $x8a($this->_columns[$x44 - 1]))) $x66["\164\x6ft\x61\154"]+=$x45;  $x6b = true;  } } else { if ($this->_total && $this->_columns[$x44 - 1] == "\164\x6ft\x61\154") { $x66["\164\x6ft\x61\154"] = $x45;  if ($x8a($x45)) $x6b = true;  else $x6b = false;  } } if (Mage::helper("\x63\157\x72\145")->isModuleEnabled("\127\171o\x6d\151n\144\137\101dv\141\156\x63\145di\156\166\145\x6e\164o\162\171") && $x6b) { if ($x8a($x45) && $x8a($this->_columns[$x44 - 1])) { $x6d = "\x20\x52EPL\101C\105\x20\x49\116\x54O\x20\140" . $this->_tables["a\151\163"] . "\x60 \x28`i\144`\54\x20\x60\x6c\x6f\143\141\x6c\x73\164\x6fc\x6b_\x69\144\x60\x2c\x60\160\154\141\x63e\137\x69d\x60\x2c\140\x71\165a\x6et\x69t\171\137in_st\157c\153`\x2c`\160\162\x6fd\165\143t\137i\x64\x60,\140ba\143\x6b\157r\144\145\162\x5f\x61\154l\x6fwe\x64\140\x2c`us\x65\x5fco\x6efig\137sett\x69\156\147_\x66o\x72\137b\x61\143\153\157\x72d\x65r\163\140\x29\40\x76\x61\x6c\x75es(\15\12 \x20\40 \40\x20 \x20\x20\40\40\x20\x20\40\x20 \x20\x20\40\40\40\40\40\40\x20\40\x20 \40 \x20 \40\x49\106\x28(S\105\114\x45CT c\157u\x6et\x28`\151d\x60)\40\x46RO\x4d `" . $this->_tables["a\151\163"] . "\140\40A\x53\x20\x61\x20\x57HE\x52\105 \x60\160\x6ca\x63e\x5f\x69\x64\x60=" . $this->_columns[$x44 - 1] . "\x20\x41ND\x20\x20\140\160r\157du\143t\x5f\151d\x60\x3d" . $x69 . ")\75\61,(\123E\114\105CT\40`\x69d\140 F\122\117\x4d\x20" . $this->_tables["a\151\163"] . "\40A\x53 a\x20\x57H\105R\105 \140\x70\154\141ce\x5fi\144\140=" . $this->_columns[$x44 - 1] . "\40\x41\x4e\104\x20\x60\160\x72\157\144\165\143\164\137\151\x64\x60\75" . $x69 . "),NULL) ,$x6a," . $this->_columns[$x44 - 1] . ",$x45,$x69,IFNULL((SELECT `backorder_allowed` FROM `" . $this->_tables["a\151\163"] . "\140\40\101\123\40`\142\x60\40\x57\110\105\122\x45 \140pl\x61\x63\145_id\140=" . $this->_columns[$x44 - 1] . "\40\x41\x4e\104\x20\x60\160\x72\157\144\165\143\164\137\151\x64\x60\75" . $x69 . "\51\54\60\x29\54I\106N\125\x4cL((\x53\105\114\105\x43\124\40\140\x75\x73\145\x5fco\156\x66i\x67\137\163e\164t\151ng_\x66\157r\x5f\142\x61\143\x6b\157r\144\x65\x72\163`\x20\106RO\115\40`" . $this->_tables["a\151\163"] . "\140 \x41\123\40\x60\143\x60 \127H\x45\x52E \x60\160l\x61\x63\145\137\151\144\x60=" . $this->_columns[$x44 - 1] . "\40\x41\x4e\104\x20\x60\160\x72\157\144\165\143\164\137\151\x64\x60\75" . $x69 . "\51,\61\x29)\73";  $x8b($this->_sql, $x6d);  $x67[] = "\55I\x46N\125\114L\x28\50SE\114\105C\124\40\x60q\165a\156\164\x69t\171\137\151\x6e_\163t\x6f\143k` \106RO\x4d\40`" . $this->_tables["a\151\163"] . "` \127\110\105\122\x45\x20`\x70\154\x61\143\145\x5fi\x64\x60\x3d" . $this->_columns[$x44 - 1] . "\x20\x41ND\x20\x20\140\160r\157du\143t\x5f\151d\x60\x3d" . $x69 . "\40),0\x29";  } } if (!$this->getAutoSetInstock()) { if ($this->_is_in_stock && $this->_columns[$x44 - 1] == "\x69\x73_\x69n_\x73\x74\157\143\x6b") { if ($x7e($x8c($x45), array("\61", "\164\x72\x75\x65", "y\145\x73", "\x6f\156", "\x69n\x20\163\x74ock", "in\x73\x74\157\x63\x6b", "\x61va\x69\x6c\x61bl\145"))) $x66["in\137s\164\157ck"] = true;  else $x66["in\137s\164\157ck"] = false;  } } else { if ($x66["\164\x6ft\x61\154"] > 0) $x66["in\137s\164\157ck"] = true;  else $x66["in\137s\164\157ck"] = false;  } if ($this->_manage_local_stock && $this->_columns[$x44 - 1] == "\155anage\x5f\x6c\157c\x61\x6c\137\163\164\x6f\143\153") { if ($x7e($x8c($x45), array("\61", "\164\x72\x75\x65", "y\145\x73", "\x6f\156", "\x69n\x20\163\x74ock", "in\x73\x74\157\x63\x6b", "\x61va\x69\x6c\x61bl\145"))) $x66["\155anage\x5f\x6c\157c\x61\x6c\137\163\164\x6f\143\153"] = 1;  else $x66["\155anage\x5f\x6c\157c\x61\x6c\137\163\164\x6f\143\153"] = 0;  } else { $x66["\155anage\x5f\x6c\157c\x61\x6c\137\163\164\x6f\143\153"] = 1;  } if ($x8d($this->_columns[$x44 - 1], "\141\x74t\x72i\x62u\164\x65")) { $x6e = ($x8e('-', $this->_columns[$x44 - 1]));  $x6f = Mage::getSingleton("\x63\x6f\162\x65\x2f\162\145sou\x72c\145")->getTableName("\x63\141ta\154o\x67\137\x70\162odu\143\x74_e\x6e\x74\151\x74\x79_" . $x6e[3]);  $x6d = "UPDATE `$x6f` SET `value`='" . $x8f($x45) . "\x27\40W\110\105\x52\x45 \x60\145nt\x69\164y_i\144\140\75\x27" . $x69 . "'\40AND\x20\x60\x61\x74\x74\x72i\x62u\164\x65_\x69\144\140\x3d\47" . $x6e[2] . "\47\73";  $x8b($this->_sql, $x6d);  } $x66[$x6c]["\166\x61\x6cu\145"] = $x45;  $x66[$x6c]["c\x6f\144\145"] = $this->_columns[$x44 - 1];  $x6c++;  } };  $x66["\163\x74\141\164\165s"] = $x6b;  $x70 = $x66["\164\x6ft\x61\154"];  if ($this->getAutoSetTotal() == 2) { if ($x89($x67)) $x70 = "(S\105\114EC\x54 \x28\111\106NUL\114\50S\125M\50`\161ua\x6e\164\x69\x74\171\137\151\x6e\x5fst\x6fck\x60\x29\540)" . $x7f('', $x67) . "+$x70) FROM " . $this->_tables["a\151\163"] . " WHERE `product_id`=$x69)";  else { $x6b = false;  } } $x71 = $x66["in\137s\164\157ck"];  if (Mage::helper("\x63\157\x72\145")->isModuleEnabled("\127\171o\x6d\151n\144\137\101dv\141\156\x63\145di\156\166\145\x6e\164o\162\171")) { if ($x6b) { $x6d = "\x52E\x50\x4c\101\x43\105\x20\111\x4e\124\x4f \x60" . $this->_tables["\x61i\x70"] . "` values($x6a,$x69," . $x66["\155anage\x5f\x6c\157c\x61\x6c\137\163\164\x6f\143\153"] . "\x29; ";  $x88($this->_sql, $x6d);  } } if (($x6b)) { if ($x71 === true || $x71 === false) { $x72 = "\54\40\140\151s_\151\x6e_\x73\x74\x6f\143\153\140";  $x73 = ($x71) ? '=1' : '=0';  if ($this->getAutoSetTotal() == 2) { $x73 = "= IF ($x70>0,1,0)";  } if ($this->getAutoSetInstock()) { $x74 = (int) Mage::getStoreConfig("\x63\x61\x74\x61\154\x6f\147\x69\x6e\166\x65n\164\x6f\x72\x79\57ite\155\137\x6fp\164\151ons\57\x62\x61\143\153\x6fr\144e\x72s");  $x73 = "= IF ($x70>0 OR (backorders>0 AND use_config_backorders=0) OR (use_config_backorders=1 AND $x74>0),1,0)";  } } else { $x72 = null;  $x73 = null;  } $x6d = "\125\x50DA\x54E\x20\140" . $this->_tables["c\x73\151"] . "\140\40S\x45T\x20" . " `product_id`='$x69'," . " `qty`=$x70," . "\x20\140\x73\164\157\x63k\x5f\151d`\75 \61" . " $x72 $x73 WHERE `product_id`='$x69'; ";  $x88($this->_sql, $x6d);  } if ($x6b) { $this->_notices[] = "$x68 <i>$x62[0]</i> has been updated";  } else { Mage::$x83("\52 \x50\x72o\144\x75c\x74 \43" . $x62[0] . "\40\150a\163\40b\145e\x6e \151gn\x6f\x72\145\x64 \x64\x75\x65 \164\157\40s\157\155e\40\x6e\157n\x20c\157n\x73\x69\x73\x74\145n\x74 d\141\x74a\56", null, "M\141\x73s\x53\x74\157c\x6b\x55\x70a\164\x65\x2e$x83");
 $this->_warnings[] = "$x68 <i>$x62[0]</i> has been ignored due to some non consistent data.";  } $this->_output[] = $x66;  } else { Mage::$x83("\52 \x50\x72o\144\x75c\x74 \43" . $x62[0] . " \x64\157e\163\x6e\47t\40\145\x78i\x73t\56 \120\x72odu\x63\x74\40\x68\141\163\x20be\145n ig\156o\x72\x65\144\56", null, "M\141\x73s\x53\x74\157c\x6b\x55\x70a\164\x65\x2e$x83");  $this->_warnings[] = "$x68 <i>$x62[0]</i> doesn't exist. Product has been ignored.";  } } function backup() { $x7a="stri\163\164\x72";  $x7b="\x69\x73\137r\145a\144a\x62l\145";  $x7c="\x74\x69m\145";  $x7d="\146\x69l\145\x5f\x67\x65\x74_\x63o\156t\x65\x6e\x74\163";  $x7e="\x69\156\x5fa\162ray";  $x7f="\151\x6dplo\144\x65";  $x80="\x61\162r\x61\171_\153\145y\x5fex\151st\x73";  $x81="\x74\x72\151\x6d";  $x82="s\x74r\137r\x65\x70\154\x61c\145";  $x83="\x6c\157\x67";  $x84="\151s\x5fa\x72\x72\x61\x79";  $x85="js\x6f\156_\145n\x63\157\144\x65";  $x86="\152so\156\x5f\x64\145\x63od\145";  $x87="\x61\x72\162\141\x79_\163\160\x6c\x69\x63\x65";  $x88="arra\x79\x5f\165\x6e\163\x68\x69\x66\164";  $x89="\143\157u\x6e\164";  $x8a="\151\163\137num\145\x72\x69\143";  $x8b="\141\162r\x61\x79\137p\165s\x68";  $x8c="s\164\162t\157\x6c\x6f\x77\x65\162";  $x8d="\163\164r\x73\x74\162";  $x8e="ex\160\x6c\x6fd\145";  $x8f="\x61\x64ds\x6c\x61\163\150es";  $x53 = array();  $x75 = array();  $x76 = array();  $x51 = Mage::getSingleton("\x63\x6f\162\x65\x2f\162\145sou\x72c\145");  $x52 = $x51->getConnection("\x63o\162e_\x72e\x61\144");  $this->_tables["c\x73\151"] = Mage::getSingleton("\x63\x6f\162\x65\x2f\162\145sou\x72c\145")->getTableName("cat\x61\154\x6f\147\x69\156\x76\x65n\x74\x6f\x72\x79\x5f\163t\x6f\143\x6b\x5fi\x74\x65\x6d");  $this->_tables["cp\x65"] = Mage::getSingleton("\x63\x6f\162\x65\x2f\162\145sou\x72c\145")->getTableName("\x63\x61\164\x61\x6c\157\x67\137\x70r\157\144\x75c\164_\145\156t\x69t\x79");  $x8b($x53, "L\105\106\x54\x20\112\117I\x4e\40`" . $this->_tables["cp\x65"] . "\x60 A\x53 \x60cpe\x60 \117N\40`cpe\140\56`e\x6e\x74\151\164y\137\x69\144`\x3d\x60\143\163i\140\56`\160\162o\x64\165\143t\137\x69\144`");  if (Mage::helper("\x63\157\x72\145")->isModuleEnabled("\127\171o\x6d\151n\144\137\101dv\141\156\x63\145di\156\166\145\x6e\164o\162\171")) { $x75[] = null;  $x76[] = null;  $this->_tables["a\151\163"] = Mage::getSingleton("\x63\x6f\162\x65\x2f\162\145sou\x72c\145")->getTableName("ad\x76\x61\x6e\143\x65\x64\x69\x6e\x76\x65\x6et\x6f\x72\x79_\x73t\x6fck");  $x77 = Mage::getModel("\x70\x6f\x69\x6e\164\x6f\x66\163a\x6c\x65\x2fp\x6f\151n\164of\x73\141le")->getPlaces();  foreach ($x77 as $x4d) { $x8b($x53, "L\105\106\x54\x20\112\117I\x4e\40`" . $this->_tables["a\151\163"] . "`\x20A\x53\40`a\151\137" . $x4d->getPlaceId() . "`\x20\x4f\116\x20`\x61\x69\x5f" . $x4d->getPlaceId() . "\x60\56\140\x70\x72\157\144\165c\164\137i\x64\140=\x60\143\160e\x60\x2e\140\x65\x6e\164\151\164\171_\151\144\x60 \x41\x4eD\40`\141\151\x5f" . $x4d->getPlaceId() . "\x60\x2e\140\160\x6c\141\x63\145\137\151\144`\75" . $x4d->getPlaceId() . "");  $x75[] = "a\151\x5f" . $x4d->getPlaceId() . "\x2e`\x71\165\141\x6e\164\151\164\171\x5f\151\x6e\137s\x74o\143k` A\x53\40\140a\x69_\163t\x6f\143k\x5f" . $x4d->getPlaceId() . "\x60";  } } $x88($x53, "\x53\105\114E\x43T\x20\40`c\160\x65\140.\x60\x73\153\x75\140\x20" . $x7f(', ', $x75) . "\54\40\140\143s\x69\140\56`\161\164\x79\x60\x2c\x60\x63s\x69\140.`\x69s\137i\x6e_\163\x74\x6f\143\153` FR\x4f\115\x20`" . $this->_tables["c\x73\151"] . "\x60 \x41\x53 \x60c\163\x69`");  $x8b($x53, "\127\110\105\122\x45\x20`\163k\x75\x60\40\x49S\40\116\x4f\124\40NU\114L " . $x7f(" A\x4e\104\x20", $x76) . "");  Mage::$x83("\x2d\x2d---\55\x2d\x2d\x2d\55-\55-\x2d\55\55-\x2d-\55 B\x41\103\113\x55\x50\40\x50RO\103E\123\123 \x2d\55-\x2d\x2d\55\55--\x2d\55-\55\x2d\x2d\55\x2d\55--", null, "M\141\x73s\x53\x74\157c\x6b\x55\x70a\164\x65\x2e$x83");  Mage::$x83("\x2d\x2d\55\76 \x4dy\x53\161\x6c \162e\161ue\x73\164\40\72\40" . $x7f(' ', $x53), null, "M\141\x73s\x53\x74\157c\x6b\x55\x70a\164\x65\x2e$x83");  $x62 = $x52->fetchAll($x7f("\40", $x53));  $x31 = new Varien_Io_File();  $x31->setAllowCreateFolders(true);  $x3d = Mage::getStoreConfig("\x6d\x61\x73s\163toc\153\165\160d\141\164\x65/se\x74\164i\156gs\57\x62ac\x6b\165\160\137\146i\154\x65") . "-" . $x7c() . ".\x63\x73v";  $x78 = Mage::getStoreConfig("\155\x61s\x73\x73to\x63k\x75p\144\x61te\57s\145t\x74\x69\x6e\147s\57b\141\143k\165\x70\137d\x69\162");  $x31->open(array("\x70\x61\164\x68" => Mage::getBaseDir() . "\x2f" . $x78));  if ($x31->fileExists($x3d) && !$x31->isWriteable($x3d)) { Mage::throwException(Mage::helper("o\x72\144\x65r\163\145\170\x70\x6f\162\x74\164\x6fol")->__("\x46\151\154e\x20'\45s' \x63a\156\x6eo\x74\40\142\x65\x20s\141ved\x2e\x20\x50\154\x65\x61\163\145,\40\155\141k\145\40s\165\x72\x65\40\x74\x68e \144\x69\162\x65c\164o\x72y\x20%s\x27\x20\x69s\40\167\162\151te\x61\142\x6c\145 \142\171 \x77\x65\x62 \x73\x65\x72\x76\145r\x2e", $x3d, $this->getPath()));  } $x31->streamOpen($x3d, "\x77");  foreach ($x62 as $x79) { $x31->streamWriteCsv($x79, "\73");  } $x31->streamClose();  Mage::getSingleton("co\x72\x65\x2f\x73\145\163s\x69\157n")->addSuccess(Mage::helper("m\x61\x73\x73s\164ock\x75\160\144\141t\x65")->__("\x42\x61\143kup \143r\x65\141\x74\145\x64 \72\x20 \x20\x27\45s\47\x2e", $x78 . $x3d));  Mage::$x83("-\55\x2d> \x44\x4f\x4e\105 \x3a\40" . $x78 . $x3d, null, "M\141\x73s\x53\x74\157c\x6b\x55\x70a\164\x65\x2e$x83");  return;  } } ; 