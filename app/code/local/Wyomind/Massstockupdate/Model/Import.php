<?php class Wyomind_Massstockupdate_Model_Import extends Mage_Core_Model_Abstract { public $_warnings = array();
 public $_notices = array();  public $_sql = array();  public $_columns = array();  public $_products = array();  public $_stocks = array();  public $_autoInc = 0;  public $_tables = array();  public $_total = false;  public $_is_in_stock = false;  public $x22 = false;  public $_output = array();  public $x23 = array();  public function _construct() { $x62="\x73\164rist\162";  $x63="\151\163\137\x72e\x61d\x61\142le";  $x64="\x74im\145";  $x65="l\157g";  $x66="\151s\x5fa\x72ray";  $x67="j\163\157n_\x65\x6e\143\x6f\x64\145";  $x68="\x74\x72im";  $x69="j\x73\157\156_\144\x65code";  $x6a="in_\141\162r\x61\x79";  $x6b="\141\x72\x72\141\171\x5f\163p\x6cic\x65";  $x6c="\141\x72r\x61y\x5f\165\156\x73\x68\x69f\x74";  $x6d="s\164\162_\162e\x70\154\x61ce";  $x6e="\143\157un\x74";  $x6f="implo\x64e";  $x70="\x69\163\x5f\156\165\155\x65r\151\143";  $x71="\x61\x72\x72\x61\171\137\x70\x75\163h";  $x72="\163\164\162\164\157\154\157\167\x65\162";  $x73="\x73\164\x72\163tr";  $x74="\x65\x78\160\154\157de";  $x75="ad\x64\x73\x6c\x61she\163";  parent::_construct();  $this->_init("\155\x61\163\x73\x73t\157c\x6b\165\160\144\141\164\x65/\x69m\x70ort");  } protected function _beforeSave() { $x62="\163\164ris\x74\x72";  $x63="\151\163\137\162e\141\x64\x61\142\154\145";  $x64="\x74\x69\155e";  $x65="\x6c\157\x67";  $x66="\x69s_\x61\162\162\141y";  $x67="\x6a\163o\156\137\x65\x6e\x63\157d\145";  $x68="t\x72i\x6d";  $x69="j\x73\157\x6e_\144ec\157de";  $x6a="i\x6e\x5f\141\x72\162a\x79";  $x6b="a\162\x72a\171_s\x70\154i\x63\145";  $x6c="\141\x72\x72ay\137\165n\x73\x68\151f\164";  $x6d="\163\x74r_\x72ep\154ac\x65";  $x6e="co\x75\x6e\164";  $x6f="\151m\x70lode";  $x70="\x69\163\137\156\165m\145\x72\151c";  $x71="a\162r\141\171\x5f\160\x75\163\x68";  $x72="st\162\164\x6f\x6c\157\x77\x65\162";  $x73="s\164\x72\163tr";  $x74="\145\x78pl\x6fd\145";  $x75="a\144d\x73l\x61\163\x68e\163";  if ($this->getFileSystemType() !== "\61") { $x24 = new Varien_Io_File();  $x25 = $x24->getCleanPath(Mage::getBaseDir() . "\57" . $this->getFilePath());  if (!$x24->fileExists($x25, false)) { Mage::throwException(Mage::helper("\155\x61ss\x73to\143\x6b\x75\x70\x64\x61te")->__("\x57\x72\x6f\156\147 f\151l\x65\40\x70a\x74h\56 '\45\163\x27\x20\151s\40\156o\164 a\40fil\145\56", $x25));  } if ($x62($this->getFilePath(), "\56\143\x73\166") < 0) { Mage::throwException(Mage::helper("\155\x61ss\x73to\143\x6b\x75\x70\x64\x61te")->__("\x57\x72\x6fn\x67\x20\x66i\x6c\x65\56\40'%\163\x27\40\x69s\x20n\x6f\x74\x20\141\40\x63\x73\x76\40\x66\151l\145\x2e", $x25));  } if (!$x63($x25)) { Mage::throwException(Mage::helper("\155\x61ss\x73to\143\x6b\x75\x70\x64\x61te")->__("Pl\145ase\40mak\145\x20\x73\x75r\145\x20\164\x68a\x74 \x27\x25s\47\x20\151\x73\x20\162ea\x64\141\142l\x65\40by \x77\x65\x62-\163\145\162\166\145\162\x2e", $x25));  } } return parent::_beforeSave();  } public function x76() { $x62="s\164\162i\x73t\x72";  $x63="i\163\137re\141\144\141b\x6c\x65";  $x64="tim\145";  $x65="\x6cog";  $x66="\x69s\137\141rr\x61\x79";  $x67="\152\x73\157\x6e\x5f\x65ncod\x65";  $x68="\x74\x72i\155";  $x69="\152s\157\x6e\137de\x63\x6fd\145";  $x6a="\151\156\137arra\x79";  $x6b="\x61\x72\x72ay\x5fsp\154ic\x65";  $x6c="\x61\162\162\141y\x5f\x75\x6e\x73hif\164";  $x6d="\x73\164\x72_\162\x65\x70\154\141c\x65";  $x6e="c\157\x75\156\164";  $x6f="i\155\160\154\x6fd\x65";  $x70="\151\x73\x5fn\x75\x6d\145\162\x69\x63";  $x71="\141\x72\162a\x79_\160us\150";  $x72="\163\x74rto\154\157\x77\145\x72";  $x73="\163t\162s\164\162";  $x74="ex\x70lod\x65";  $x75="\141d\x64\x73\x6ca\x73h\145\x73";  $this->_warnings = array();  $this->_notices = array();  $this->_sql = array();  $this->_columns = array();  $this->_products = array();  $this->_stocks = array();  $this->_autoInc = 0;  $this->_tables = array();  $this->_total = false;  $this->_output = array();  } private function x77() { $x62="\163\x74ris\x74\x72";  $x63="\x69s\x5f\162e\141\x64\141\142\x6c\145";  $x64="\164i\155e";  $x65="\154\157g";  $x66="i\163\x5f\141\x72\x72\x61\171";  $x67="\x6a\x73\x6f\156\137\x65\x6e\143\157d\x65";  $x68="t\162\151m";  $x69="jso\156_\x64\x65\143\x6f\144e";  $x6a="in_a\x72\x72a\x79";  $x6b="\141\162\x72ay_\163\x70\154\x69\143\145";
 $x6c="a\162\x72\141\x79\137\165\156\163\x68\x69\x66t";  $x6d="\x73\x74r\x5f\x72\x65\160\154\x61\x63\145";  $x6e="\x63o\165\156t";  $x6f="\x69\x6dp\154\x6f\x64\145";  $x70="is\x5f\x6eu\x6d\145r\151\143";  $x71="\141\162r\141\x79\x5fp\165s\x68";  $x72="\163\164\162\x74\157l\x6fw\x65\162";  $x73="\x73t\x72\x73\x74\x72";  $x74="\145\170p\x6c\x6f\144\145";  $x75="a\x64d\x73\x6c\141s\x68e\x73";  $x26 = $this->getFtpHost();  $x27 = $this->getFtpLogin();  $x28 = $this->getFtpPassword();  $x29 = $this->getFtpDir();  $x2a = $this->getUseSftp();  $x2b = $this->getFtpActive();  if ($x2a) $x2c = new Varien_Io_Sftp();  else $x2c = new Varien_Io_Ftp();  try { $x2c->open( array( 'host' => $x26, 'user' => $x27, 'username' => $x27, 'password' => $x28, 'timeout' => '120', 'path' => $x29, 'passive' => !($x2b) ) );  if ($x2c->cd($x29)) { $x2d = 'var/tmp/stock_import_' . $x64() . '.csv';  $x24 = new Varien_Io_File();  $x25 = $x24->getCleanPath(Mage::getBaseDir() . '/var/tmp/');  if ($x63($x25)) { $x2e = $x2c->read($this->getFilePath(), $x2d);  $x2c->close();  if (!$x2e) { return array("\124\150\x65 f\151le\x20'".$this->getFilePath()."\47\x20\143\x61\x6e\156\157\x74\x20\142\x65\x20f\x65t\143\150\145d.");  } return $x2d;  } else { $x2c->close();  return array("P\x6c\145\x61\x73\145\40\x6d\x61ke \x73\165r\145 \164\150\x61\x74 \166\x61\x72\x2f\164mp\x20\151\163\40\x77\162i\164\x61bl\x65.");  } } else { $x2c->close();  return array("Cannot access '$x29' on this server.");  } } catch (Exception $x2f) { return $x2f->getMessage();  } } public function importProcess() { $x62="s\x74r\151\x73\164\162";  $x63="\151s\x5fre\x61d\141bl\145";  $x64="t\x69\x6de";  $x65="\154\x6fg";  $x66="\151\163_\141\x72\x72\x61\x79";  $x67="j\163\157\x6e\x5fen\143\157d\145";  $x68="\164\x72\151\x6d";  $x69="j\x73\157n\x5fdec\x6f\x64e";  $x6a="i\156_ar\162\141\x79";  $x6b="arr\141\x79\137\163\160li\x63\x65";  $x6c="\141\x72\162\x61\171\137\x75\x6e\163\150i\146t";  $x6d="\163\x74\162\x5fr\145p\154\141\143\145";  $x6e="\x63o\x75\x6et";  $x6f="\x69\x6d\x70\154\157\144e";  $x70="i\163\x5f\156u\x6de\162i\x63";  $x71="\x61rray\137\160\x75\x73\150";  $x72="\x73\x74\162t\157\154ow\x65\x72";  $x73="s\x74rst\162";  $x74="e\170\x70lo\144\145";  $x75="a\x64\x64\x73\154\141\x73\x68\145\163";  Mage::$x65("\55\x2d\x2d\x2d-\x2d-\x2d\x2d-\x2d-\x2d\x2d-\55---\55\x20\111MP\x4f\122\x54\x41\x54\x49O\116\40\x50R\x4f\x43E\123\123 \55\x2d--\x2d\55--\x2d\x2d\x2d-\x2d\x2d-", null, "\115\x61s\163\123t\x6fck\x55\x70\x61te.l\157\x67");  $this->x76();  $x30 = $this->getFilePath();  if ($this->getFileSystemType() === "\61") { $x2e = $this->x77();  if ($x66($x2e)) { $x31['status'] = 'error';  $x31['body'] = $x2e[0];  die($x67($x31));  } else { $x30 = $x2e;  } } $x24 = new Varien_Io_File();  $x25 = $x24->getCleanPath(Mage::getBaseDir() . "\57" . $x30);  $x24->streamOpen($x25, "\x72");  Mage::$x65("\55->\x20\x46\x69\154e\x20\157pe\156\145\144 \72 " . $x25, null, "\115\x61s\163\123t\x6fck\x55\x70\x61te.l\157\x67");  $x32 = $this->getIdentifierCode() ? $this->getIdentifierCode() : "\163\x6b\x75";  $x33 = Mage::getModel("c\141\x74a\x6c\157\x67\x2f\x70\x72o\144u\x63\x74")->getCollection()->addAttributeToSelect($x32);  foreach ($x33 as $x34) { $this->_products[$x68($x34->getData($x32))] = $x34->getId();  };  Mage::$x65("-->\40\x50\162\157\144uct\163\x20\143\157\154\154e\143\x74\x65\x64", null, "\115\x61s\163\123t\x6fck\x55\x70\x61te.l\157\x67");  if (Mage::helper("\x63\157\162\145")->isModuleEnabled("Wyo\155i\x6e\144_\x41\x64\x76\x61n\143e\144inve\156t\x6f\162\x79")) { $x35 = Mage::getModel("a\144\166\x61\x6ec\x65d\151\156ve\x6e\164o\x72y\x2f\x73\164\x6f\143\x6b")->getCollection();  foreach ($x35 as $x36) { $this->_stocks[$x36->getProductId()] = $x36->getId();  };  Mage::$x65("-\x2d\x3e\x20\x4c\x6fc\x61\x6c\40s\x74\157c\x6b\163\x20\143\x6f\x6cl\145ct\145\x64\x20(\101\144v\141n\x63\145d\40\111\x6e\166en\164\157ry)", null, "\115\x61s\163\123t\x6fck\x55\x70\x61te.l\157\x67");  } $x37 = array("\141\143" => "\x61\x63t\151\x76a\x74\151\157n\x5f\x63\x6f\x64\x65", "\x61\153" => "\x61\143\164\151\166\x61t\x69on_\153\145\171", "b\165" => "\x62\x61\163e\x5f\x75\x72\x6c", "\x6d\144" => "\x6d\144\65", "t\150" => "thi\x73", "\144\155" => "\137\x64e\x6d\x6f", "\145x\164" => "m\163\x69", "\x76e\x72" => "\63.\70\x2e0");  $x38 = Mage::getSingleton("c\x6f\x72\x65\57\162\x65s\157urc\145");  $x39 = $x38->getConnection("\x63\x6f\162e\137r\145\x61\144");  $this->_tables["\143s\151"] = Mage::getSingleton("c\x6f\x72\x65\57\162\x65s\157urc\145")->getTableName("\x63\141\x74\x61\x6c\157\x67\x69\x6e\x76\145nto\162\x79\137\x73\164\x6f\143\153\137i\164\x65\x6d");  if (Mage::helper("\x63\157\162\145")->isModuleEnabled("Wyo\155i\x6e\144_\x41\x64\x76\x61n\143e\144inve\156t\x6f\162\x79")) { $this->_tables["a\x69\160"] = Mage::getSingleton("c\x6f\x72\x65\57\162\x65s\157urc\145")->getTableName("\x61\x64\x76\141n\x63\145\144\x69\156v\x65\x6e\164\x6f\x72\171\137\151te\x6d");  $this->_tables["\141i\163"] = Mage::getSingleton("c\x6f\x72\x65\57\162\x65s\157urc\145")->getTableName("\141\144v\141n\x63ed\x69\156\166\145\156\x74ory\x5fsto\x63k");  $x3a = "S\105\x4c\x45\103\x54\40MA\x58\50\x69d\51\x20AS \x49\x4e\x43\x20FR\x4f\x4d " . $this->_tables["a\x69\160"] . "\x20\x3b";  $x3b = $x39->fetchAll($x3a);  $this->_autoInc = $x3b[0]["\111\x4e\103"];  Mage::$x65("-\55>\40\x4da\x78\40inc\162\145\155\145n\164 f\157u\x6e\x64 \x23" . $x3b[0]["\111\x4e\103"] . "(\x41dv\141n\143ed \x49\156\166e\x6et\157r\171)", null, "\115\x61s\163\123t\x6fck\x55\x70\x61te.l\157\x67");  } $x3c = array( "\x61\143\164\151\166\x61t\x69on_\153\145\171" => Mage::getStoreConfig("\x6d\141ss\x73\164\157\x63ku\x70\144at\145/\x6c\151\143e\156\x73\x65\57a\143\x74\x69\x76\x61\164\151o\x6e\137\x6b\145y"), "\x61\x63t\151\x76a\x74\151\157n\x5f\x63\x6f\x64\x65" => Mage::getStoreConfig("\155\x61\163s\x73t\x6f\143\x6bu\x70\144\x61\164e/l\151\143\145\156se\x2fa\x63\x74i\166\141\164\x69\157\x6e_\143o\x64e"), "\x62\x61\163e\x5f\x75\x72\x6c" => Mage::getStoreConfig("\167e\142\x2f\x73\x65\x63\165\x72\x65\57bas\145_\165\162l"), );  $x3d = $x69($this->getMapping());  foreach ($x3d->columns as $x3e => $x3f) { if (!$x6a($x3f->id, array("n\x6ft-\x75se\x64", "\x74\157\164\x61\x6c", "\x69s\x5f\151\x6e\x5fs\x74\157\143\x6b", "\155\x61\156\x61\147e\x5f\154\x6f\x63\x61\x6c\x5f\x73\164\x6f\143\x6b"))) { $this->_columns[] = $x3f->id;  } elseif ($x6a($x3f->id, array("\x74\157\164\x61\x6c"))) { $this->_columns[] = "\x74\157\164\x61\x6c";  $this->_total = $x3e + 1;  } elseif ($x6a($x3f->id, array("\x69s\x5f\151\x6e\x5fs\x74\157\143\x6b"))) { $this->_columns[] = "\x69s\x5f\151\x6e\x5fs\x74\157\143\x6b";  $this->_is_in_stock = $x3e + 1;  } elseif ($x6a($x3f->id, array("\155\x61\156\x61\147e\x5f\154\x6f\x63\x61\x6c\x5f\x73\164\x6f\143\x6b"))) { $this->_columns[] = "\155\x61\156\x61\147e\x5f\154\x6f\x63\x61\x6c\x5f\x73\164\x6f\143\x6b";  $this->_manage_local_stock = $x3e + 1;  } else { $this->_columns[] = false;  } } Mage::$x65("\x2d\55\76\40C\x6fl\x75\x6dn \x6d\141\x70\160\151\x6e\x67 an\141\154\x79ze\144", null, "\115\x61s\163\123t\x6fck\x55\x70\x61te.l\157\x67");  if ($x3c[$x37["\141\143"]] != $x37["\x6d\144"]($x37["\x6d\144"]($x3c[$x37["\x61\153"]]) . $x37["\x6d\144"]($x3c[$x37["b\165"]]) . $x37["\x6d\144"]($x37["\145x\164"]) . $x37["\x6d\144"]($x37["\x76e\x72"]))) { $$x37["\145x\164"] = "\166ali\x64";  $$x37["t\150"]->$x37["\144\155"] = true;  } else { $$x37["t\150"]->$x37["\144\155"] = false;  $$x37["\145x\164"] = "\166ali\x64";  } if (!isset($$x37["\145x\164"]) || $$x37["t\150"]->$x37["\144\155"]) { $$x37["t\150"]->$x37["\144\155"] = true;  return $$x37["t\150"];  } Mage::$x65("\x2d\55\76\40P\162ep\141\x72\151\156\x67 \x4dy\x53q\154\40\161\165\145r\151\x65\x73", null, "\115\x61s\163\123t\x6fck\x55\x70\x61te.l\157\x67");
 $x40 = $this->getSkuOffset() - 1;  $x41 = new Varien_Io_File();  $x41->setAllowCreateFolders(true);  $x42 = Mage::getStoreConfig("\155\x61\x73\163sto\x63\x6bup\144\x61\164\x65/\163et\164i\156gs\57\163q\154\x5f\x66\151l\145");  $x43 = Mage::getStoreConfig("m\x61\163\163\x73t\157\x63\153\x75\160d\x61\x74\145/set\164\151\156g\x73\57\x73\161l_\x64\x69\162");  $x25 = $x24->getCleanPath(Mage::getBaseDir() . '/' . $x43);  if (!$x41->fileExists($x25, false)) { Mage::throwException(Mage::helper('massstockupdate')->__('Please create the specified folder "%s".', $x25));  } if (!$x41->isWriteable($x25)) { Mage::throwException(Mage::helper('massstockupdate')->__('Please make sure that "%s" is writable by web-server.', $x25));  } $x41->open(array('path' => $x43));  $x41->streamOpen($x42, 'w');  if ($this->getAutoSetTotal() == 2) { $x41->streamWrite("\123\105T \x66\157re\151\x67\156_\x6b\x65y\x5fc\150\145\143\x6b\x73=0\73");  } if ($this->getFileEnclosure() != "\x6e\157\x6e\145") { while (false !== ($x44 = $x24->streamReadCsv($this->getFileSeparator(), $this->getFileEnclosure()))) { $x45 = $x6b($x44, $x40, 1);  $x6c($x44, $x45[0]);  $this->x78($x44);  foreach ($this->_sql as $x3a) { $x41->streamWrite($x6d(array("\x0a", "\40\40"), array("\40", ""), $x68($x3a)) . "\x0a");  } } } else { while (false !== ($x44 = $x24->streamReadCsv($this->getFileSeparator()))) { $x45 = $x6b($x44, $x40, 1);  $x6c($x44, $x45[0]);  $this->x78($x44);  foreach ($this->_sql as $x3a) { $x41->streamWrite($x6d(array("\x0a", "\40\40"), array("\40", "\40"), $x68($x3a)) . "\x0a");  } } } Mage::$x65("\x2d\55\76 \106\x69le\x20\143l\x6f\x73\x65d\40\72\40" . $x25 . $x42, null, "\115\x61s\163\123t\x6fck\x55\x70\x61te.l\157\x67");  $x24->streamClose();  if ($this->getAutoSetTotal() == 2) { } $x41->streamClose();  if ($x6e($this->_warnings)) Mage::getSingleton("\143\x6f\x72\145/\x73\145s\x73\x69\x6fn")->addError($x6f("<\142\162\76", ($this->_warnings)));  if (Mage::getStoreConfig("\155\141s\x73\x73\x74\x6f\143k\x75\x70d\141t\x65/s\145\x74\164in\147\x73/sh_\x6d\x6f\144\145")) { return true;  } $x46 = Mage::getSingleton("c\x6f\x72\x65\57\162\x65s\157urc\145")->getConnection("\x63\x6f\162\145\x5f\x77\162i\164\145");  $x46->beginTransaction();  $x47 = true;  Mage::$x65("-\x2d\x3e \105\170\x65\x63\x75\164i\x6e\147 M\171Sq\154\x20\161\165\x65\x72\x69\145\x73", null, "\115\x61s\163\123t\x6fck\x55\x70\x61te.l\157\x67");  $x24 = new Varien_Io_File();  $x24->streamOpen($x25 . $x42, "\x72");  while (false !== ($x3a = $x24->streamRead(102400))) { try { $x46->exec($x3a);  } catch (Mage_Core_Exception $x2f) { Mage::$x65("\40\146\141il\x65\144 \x2d\55\76" . $x3a, null, "\115\x61s\163\123t\x6fck\x55\x70\x61te.l\157\x67");  $x47 = false;  } catch (Exception $x2f) { Mage::$x65("\40\146\141il\x65\144 \x2d\55\76" . $x3a, null, "\115\x61s\163\123t\x6fck\x55\x70\x61te.l\157\x67");  Mage::getSingleton("\143\x6f\x72\145/\x73\145s\x73\x69\x6fn")->addError($x2f->getMessage());  $x47 = false;  } } if (!$x47) { Mage::$x65("\55\55>\40\115y\x53\x71\154\x20\122\x6f\x6c\x6c\142a\x63k", null, "\115\x61s\163\123t\x6fck\x55\x70\x61te.l\157\x67");  Mage::getSingleton("\143\x6f\x72\145/\x73\145s\x73\x69\x6fn")->addError(Mage::helper("\155\x61ss\x73to\143\x6b\x75\x70\x64\x61te")->__("Er\x72\157r \167\150i\x6c\x65\x20p\x72\157\143\x65\163s\x69\x6e\x67.\x20\122\x6f\154\154b\x61c\153\x20h\x61\x70p\145\156e\144\56"));  $x46->rollback();  return false;  } else { Mage::$x65("\x2d\x2d>\40My\x53\161\x6c\x20Co\x6d\x6d\x69\164", null, "\115\x61s\163\123t\x6fck\x55\x70\x61te.l\157\x67");  $x46->commit();  $this->setImportedAt(Mage::getSingleton("\x63o\x72\x65\57\x64\141\x74\x65")->gmtDate("\131\x2d\x6d\x2dd \x48\x3a\151\x3a\x73"));  $this->save();  $x48 = Mage::getSingleton('index/indexer')->getProcessByCode('cataloginventory_stock');  $x48->reindexAll();  Mage::$x65("\x2d\x2d\x3e\x20St\x6f\x63\153\x20\x72e-\x69\x6e\144\145\170\145\144", null, "\115\x61s\163\123t\x6fck\x55\x70\x61te.l\157\x67");  $x24->open(array('path' => $x43));  $x24->rm($x42);  return true;  } } private function x78($x49) { $x62="\163\x74r\x69\x73t\162";  $x63="\x69\163\137\x72\145\x61\144\141b\154\x65";  $x64="\164im\145";  $x65="\x6c\x6f\147";  $x66="i\163_ar\162\141\x79";  $x67="\x6as\x6f\x6e\x5f\145nc\157\x64\x65";  $x68="\x74rim";  $x69="\x6a\163on_de\143\157\144\145";  $x6a="\151\156_ar\x72ay";  $x6b="\x61r\162\x61\171\x5f\x73\160\154\x69\143\x65";  $x6c="\x61\x72ray_u\156\163\150ift";  $x6d="\163t\162\137\162\145p\154\x61ce";  $x6e="\143\x6f\165n\x74";  $x6f="im\160\x6co\144\x65";  $x70="\151\x73\137nu\155e\162ic";  $x71="\x61\162\x72a\171_p\x75\163\x68";  $x72="\163\x74rt\x6fl\x6f\x77\145\162";  $x73="\x73tr\163t\162";  $x74="e\170\x70l\x6f\x64\145";  $x75="\141dd\163l\x61s\x68e\x73";  $this->_sql = array();  foreach ($x49 as $x4a => $x4b) $x49[$x4a] = $x68($x4b);  if ($this->getUseCustomRules()) { $x4c = $this->getCustomRules();  eval($x6d('$C[', '$x49[', $x4c));  } $x4d = array();  $x4e = array();  $x32 = $this->getIdentifierCode() ? $this->getIdentifierCode() : "\163\x6b\x75";  $x4f = Mage::getModel('eav/config')->getAttribute(Mage_Catalog_Model_Product::ENTITY, $x32)->getFrontendLabel();  if (isset($this->_products[$x49[0]])) { $x50 = $this->_products[$x49[0]];  if (isset($this->_stocks[$x50])) { $x51 = $this->_stocks[$x50];  } else { $this->_autoInc++;  $x51 = $this->_autoInc ;  } $x4d["\x49\x44"] = $x50;  $x52 = true;  $x4d["\163\164\141t\x75\x73"] = $x52;  $x4d["\x74\157\164\x61\x6c"] = 0;  $x4d["\x69\156\137s\x74\157\143k"] = null;  $x53 = 0;  foreach ($x49 as $x3e => $x54) { if (isset($this->_columns[$x3e - 1]) && $x3e > 0) { if (!$this->_total) { if ($x70($x54) && $x52) { if ($this->_columns[$x3e - 1] != "\x74\157\164\x61\x6c" && $this->_columns[$x3e - 1] != "\x69s\x5f\151\x6e\x5fs\x74\157\143\x6b" && ($this->_columns[$x3e - 1] == "\165\163\x65\x64" || $x70($this->_columns[$x3e - 1]))) $x4d["\x74\157\164\x61\x6c"]+=$x54;  $x52 = true;  } } else { if ($this->_total && $this->_columns[$x3e - 1] == "\x74\157\164\x61\x6c") { $x4d["\x74\157\164\x61\x6c"] = $x54;  if ($x70($x54)) $x52 = true;  else $x52 = false;  } } if (Mage::helper("\x63\157\162\145")->isModuleEnabled("Wyo\155i\x6e\144_\x41\x64\x76\x61n\143e\144inve\156t\x6f\162\x79") && $x52) { if ($x70($x54) && $x70($this->_columns[$x3e - 1])) { $x55 = "\x20\122\x45P\114ACE\40\x49NTO\40`" . $this->_tables["\141i\163"] . "\140\40\x28`i\x64\140,\x20\140\154\157cals\164\157c\153\x5f\x69\144\x60\x2c\x60pl\x61\x63e\137id\140\54\x60q\x75\x61\x6et\151t\171\137in\x5f\163\164\x6fck\140,\x60\x70r\157\x64uc\x74_\151\144`\x2c`b\141c\153\157\162\x64\x65\x72\x5fal\154\157\167e\144`,\x60\x75\x73e\x5f\x63\157\156f\151g_\x73\145\164ting\x5f\x66\x6fr_\142\x61\143\153o\x72\x64\x65\162\163\x60\51 v\x61\154\x75e\x73\x28\15 \x20\x20\40 \x20\40 \40\40\x20 \x20\x20\x20\x20\40\40\x20\x20\x20 \x20 \x20 \x20\40\40\x20\40\x20\x20 IF\x28\50\x53\x45\x4c\x45\103\124\x20\x63o\x75\x6e\x74\x28\x60id\x60)\x20\106\122\x4f\x4d \x60" . $this->_tables["\141i\163"] . "` \101\x53\x20a\x20\127\x48\x45\122\x45\40`\x70la\x63\145_\x69\144\140=" . $this->_columns[$x3e - 1] . " A\116D\x20\x20`\x70r\157\x64\x75\x63\x74_\x69\144\140\75" . $x50 . "\x29\x3d\61,(SE\114E\x43\x54\40`i\144\140 \106\122\117\115\40" . $this->_tables["\141i\163"] . "\x20A\x53\40\x61\40W\x48E\122\x45\40\140\160\154a\143e_\151\144\x60\x3d" . $this->_columns[$x3e - 1] . " AN\x44\x20`pro\144\x75\143t_\151d\140=" . $x50 . "),NULL) ,$x51," . $this->_columns[$x3e - 1] . ",$x54,$x50,IFNULL((SELECT `backorder_allowed` FROM `" . $this->_tables["\141i\163"] . "\140\40\x41\x53\x20\x60\142\140\x20\127\110\x45\122E\40\x60\160\x6c\x61c\145\137\151\x64`\75" . $this->_columns[$x3e - 1] . " AN\x44\x20`pro\144\x75\143t_\151d\140=" . $x50 . ")\54\x30\x29,\x49\x46\x4eUL\114(\50S\105\x4c\105\x43\124\x20`u\163\145\x5f\x63\157n\x66\151g\x5f\x73\x65\164t\151\156\x67\x5f\146\157r_\142\141ck\157\x72\x64\x65\x72\163\140\x20F\x52\x4fM\40\x60" . $this->_tables["\141i\163"] . "\140\40\101S\40`\143\x60\40\x57\110\x45R\105\40\x60\160l\141\x63\145\137i\144`=" . $this->_columns[$x3e - 1] . " AN\x44\x20`pro\144\x75\143t_\151d\140=" . $x50 . "\x29\54\61)\51\73";  $x71($this->_sql, $x55);  $x4e[] = "\x2d\111FN\125\x4c\114\x28\x28\123E\x4c\x45C\x54 \x60\x71\x75\141\x6e\x74\x69t\171_in\137\163\164o\x63\x6b`\40\x46\122\117\115 \x60" . $this->_tables["\141i\163"] . "` \127\x48\x45R\105\40\x60\x70l\x61\x63\145_id\140=" . $this->_columns[$x3e - 1] . " A\116D\x20\x20`\x70r\157\x64\x75\x63\x74_\x69\144\140\75" . $x50 . " ),\60)";  } } if (!$this->getAutoSetInstock()) { if ($this->_is_in_stock && $this->_columns[$x3e - 1] == "\x69s\x5f\151\x6e\x5fs\x74\157\143\x6b") { if ($x6a($x72($x54), array("\61", "\164\x72\x75e", "\x79\145\x73", "\157n", "\151\x6e s\x74\157\143k", "\151nstock", "\141vai\154ab\x6ce"))) $x4d["\x69\156\137s\x74\157\143k"] = true;  else $x4d["\x69\156\137s\x74\157\143k"] = false;  } } else { if ($x4d["\x74\157\164\x61\x6c"] > 0) $x4d["\x69\156\137s\x74\157\143k"] = true;  else $x4d["\x69\156\137s\x74\157\143k"] = false;
 } if ($this->_manage_local_stock && $this->_columns[$x3e - 1] == "\155\x61\156\x61\147e\x5f\154\x6f\x63\x61\x6c\x5f\x73\164\x6f\143\x6b") { if ($x6a($x72($x54), array("\61", "\164\x72\x75e", "\x79\145\x73", "\157n", "\151\x6e s\x74\157\143k", "\151nstock", "\141vai\154ab\x6ce"))) $x4d["\155\x61\156\x61\147e\x5f\154\x6f\x63\x61\x6c\x5f\x73\164\x6f\143\x6b"] = 1;  else $x4d["\155\x61\156\x61\147e\x5f\154\x6f\x63\x61\x6c\x5f\x73\164\x6f\143\x6b"] = 0;  } else { $x4d["\155\x61\156\x61\147e\x5f\154\x6f\x63\x61\x6c\x5f\x73\164\x6f\143\x6b"] = 1;  } if ($x73($this->_columns[$x3e - 1], "a\x74tr\151b\165\164\x65")) { $x56 = ($x74('-', $this->_columns[$x3e - 1]));  $x57 = Mage::getSingleton("c\x6f\x72\x65\57\162\x65s\157urc\145")->getTableName("ca\164\141lo\x67_\x70rod\165\143t_ent\151\164\x79\x5f" . $x56[3]);  $x55 = "UPDATE `$x57` SET `value`='" . $x75($x54) . "\x27\40W\x48\105\x52E `\145\156\x74\x69\164\171_\151\144`\75'" . $x50 . "\x27\x20AN\x44 \140at\164r\151\142ute\137i\144`\75'" . $x56[2] . "\x27\x3b";  $x71($this->_sql, $x55);  } $x4d[$x53]["\166alu\145"] = $x54;  $x4d[$x53]["\x63od\145"] = $this->_columns[$x3e - 1];  $x53++;  } };  $x4d["\163\164\141t\x75\x73"] = $x52;  $x58 = $x4d["\x74\157\164\x61\x6c"];  if ($this->getAutoSetTotal() == 2) { if ($x6e($x4e)) $x58 = "\50SEL\105\103T\x20\50I\x46NULL\x28\x53\125M(\x60\161\165\141n\x74\x69\164\171_in\137st\x6f\143k\x60),\60)" . $x6f('', $x4e) . "+$x58) FROM " . $this->_tables["\141i\163"] . " WHERE `product_id`=$x50)";  else { $x52 = false;  } } $x59 = $x4d["\x69\156\137s\x74\157\143k"];  if (Mage::helper("\x63\157\162\145")->isModuleEnabled("Wyo\155i\x6e\144_\x41\x64\x76\x61n\143e\144inve\156t\x6f\162\x79")) { if ($x52) { $x55 = "\122\x45\120\114A\x43\105\40INTO \x60" . $this->_tables["a\x69\160"] . "` values($x51,$x50," . $x4d["\155\x61\156\x61\147e\x5f\154\x6f\x63\x61\x6c\x5f\x73\164\x6f\143\x6b"] . "\x29; ";  $x6c($this->_sql, $x55);  } } if (($x52)) { if ($x59 === true || $x59 === false) { $x5a = "\x2c `i\163\137in\137\x73\164\x6fc\153\140";  $x5b = ($x59) ? '=1' : '=0';  if ($this->getAutoSetTotal() == 2) { $x5b = "= IF ($x58>0,1,0)";  } } else { $x5a = null;  $x5b = null;  } $x55 = "U\120\x44\101\124E \x60" . $this->_tables["\143s\151"] . "\140 \x53ET\40" . "`product_id`='$x50'," . "`qty`=$x58," . "\140s\x74\x6f\x63\x6b_i\x64\140\x3d\x20\61" . "$x5a $x5b WHERE `product_id`='$x50'; ";  $x6c($this->_sql, $x55);  } if ($x52) { $this->_notices[] = "$x4f <i>$x49[0]</i> has been updated";  } else { Mage::$x65("\x2a\40P\162o\x64uc\x74\x20#" . $x49[0] . "\x20\150\141\x73\40\x62\x65en \x69g\x6e\x6fr\x65\144\40\x64\165\145 \x74\x6f\40\163\x6f\x6d\145\x20no\156\40\x63o\156\163i\163\164e\x6et\x20\x64a\164\141.", null, "\115\x61s\163\123t\x6fck\x55\x70\x61te.l\157\x67");  $this->_warnings[] = "$x4f <i>$x49[0]</i> has been ignored due to some non consistent data.";  } $this->_output[] = $x4d;  } else { Mage::$x65("\x2a\40P\162o\x64uc\x74\x20#" . $x49[0] . "\40\144\x6f\x65\x73\156\47\x74\x20\145\170i\163\164\x2e\x20\x50\x72o\144\165\143\x74\40h\x61\163\x20b\x65\145\156\40\151gno\x72\x65\x64\56", null, "\115\x61s\163\123t\x6fck\x55\x70\x61te.l\157\x67");  $this->_warnings[] = "$x4f <i>$x49[0]</i> doesn't exist. Product has been ignored.";  } } function backup() { $x62="s\164\x72i\163\x74\x72";  $x63="\x69\x73\x5frea\144\141\142\154\145";  $x64="t\151\x6d\145";  $x65="\154og";  $x66="\x69\x73_\x61rr\x61\171";  $x67="\x6a\x73\x6f\x6e\x5f\x65\x6e\143\x6f\x64\145";  $x68="\164rim";  $x69="\x6as\157\x6e\x5fd\x65\x63\x6f\x64\x65";  $x6a="\151\x6e_\141\162\x72a\171";  $x6b="\x61rr\141\x79_\163\160\154\x69\143\145";  $x6c="\141\x72r\141\171_un\x73\x68i\146\x74";  $x6d="s\x74r_r\145pl\x61\143e";  $x6e="\x63o\165n\x74";  $x6f="\x69\x6d\160\154\x6f\x64e";  $x70="is_nu\155\x65\x72\x69\143";  $x71="ar\x72\141y_p\x75s\x68";  $x72="\x73\164r\x74\157lo\x77er";  $x73="\x73t\162s\164\162";  $x74="\x65xp\154\x6f\144\145";  $x75="\141\x64\x64\x73l\141\x73he\163";  $x3a = array();  $x5c = array();  $x5d = array();  $x38 = Mage::getSingleton("c\x6f\x72\x65\57\162\x65s\157urc\145");  $x39 = $x38->getConnection("\x63\x6f\162e\137r\145\x61\144");  $this->_tables["\143s\151"] = Mage::getSingleton("c\x6f\x72\x65\57\162\x65s\157urc\145")->getTableName("\x63\141\x74\x61\x6c\157\x67\x69\x6e\x76\145nto\162\x79\137\x73\164\x6f\143\153\137i\164\x65\x6d");  $this->_tables["cp\x65"] = Mage::getSingleton("c\x6f\x72\x65\57\162\x65s\157urc\145")->getTableName("ca\x74a\154o\147\x5f\160r\x6f\144u\143\164_\145n\164\x69\x74\171");  $x71($x3a, "LE\x46\124\40\112OI\x4e\40`" . $this->_tables["cp\x65"] . "\140 \x41S \x60\143pe\x60\40\x4f\x4e\x20\140\x63p\x65`\x2e`\145\156t\x69t\171_\x69\144`\75\140\x63\163\151\x60.\x60produ\x63\x74\x5fi\144\x60");  if (Mage::helper("\x63\157\162\145")->isModuleEnabled("Wyo\155i\x6e\144_\x41\x64\x76\x61n\143e\144inve\156t\x6f\162\x79")) { $x5c[] = null;  $x5d[] = null;  $this->_tables["\141i\163"] = Mage::getSingleton("c\x6f\x72\x65\57\162\x65s\157urc\145")->getTableName("\141\144v\141n\x63ed\x69\156\166\145\156\x74ory\x5fsto\x63k");  $x5e = Mage::getModel("p\157\x69n\x74\157fs\141\x6ce\57\160\157\151\156\164\x6f\x66sa\x6ce")->getPlaces();  foreach ($x5e as $x34) { $x71($x3a, "LE\x46\124\40\112OI\x4e\40`" . $this->_tables["\141i\163"] . "\x60\40\101\x53\40\x60a\x69_" . $x34->getPlaceId() . "\x60 O\116\40\140\141\151\137" . $x34->getPlaceId() . "\140.\x60\160\162o\x64\x75\x63t_i\x64`\75\140\x63\x70e\x60\56\140\145\x6e\x74i\164y\x5f\x69\144` \101\116\104\40\140ai\137" . $x34->getPlaceId() . "\140.`\160\x6c\x61c\145\x5fid\140\x3d" . $x34->getPlaceId() . "");  $x5c[] = "ai_" . $x34->getPlaceId() . "\56\140\x71\165\x61n\164\151\x74y\x5fin\x5f\163\x74o\x63k\x60\40\101\123\40\x60\x61i\137\x73t\157\143\153\137" . $x34->getPlaceId() . "\x60";  } } $x6c($x3a, "\123\105\114\x45\103\124\x20\x20\x60\x63\160\145\x60.\x60\x73\x6b\165\140\40" . $x6f(', ', $x5c) . ", \140\x63s\x69`\56\140\x71\164y\140,\x60\x63\163\151\x60\56`i\x73_\151\x6e_st\157\x63\153\x60\40FR\117M\x20\x60" . $this->_tables["\143s\151"] . "\140 \x41\123\x20\140cs\x69`");  $x71($x3a, "W\x48\105\x52E\x20`\x73\153\165\140 \111\123\40\x4eO\124\x20\116U\114\x4c " . $x6f("\x20\x41\116\x44\x20", $x5d) . "");  Mage::$x65("-\x2d-\x2d---\x2d-\x2d\55\55-\55-\x2d-\x2d-\55\x20\102\x41C\113\x55\x50 P\x52OC\105SS\x20--\x2d\55\x2d\55--------\55-\x2d\55--", null, "\115\x61s\163\123t\x6fck\x55\x70\x61te.l\157\x67");  Mage::$x65("\x2d\55\x2d\x3e\x20M\x79\123q\x6c\x20\162e\x71\165\145\x73\164 :\x20" . $x6f(' ', $x3a), null, "\115\x61s\163\123t\x6fck\x55\x70\x61te.l\157\x67");  $x49 = $x39->fetchAll($x6f("\40", $x3a));  $x24 = new Varien_Io_File();  $x24->setAllowCreateFolders(true);  $x5f = Mage::getStoreConfig("m\141\163sst\x6fc\153u\160\144\141t\x65\x2f\163et\164i\x6eg\x73\x2f\142\x61\x63\x6b\165p\x5f\x66\151le") . "\55" . $x64() . "\56\143\x73\166";  $x60 = Mage::getStoreConfig("\155\x61s\x73\163t\157\x63k\x75pd\x61\x74e\57\x73\x65tt\x69ng\163/back\165\x70\x5fdi\x72");  $x24->open(array("\x70\141t\x68" => Mage::getBaseDir() . "\57" . $x60));  if ($x24->fileExists($x5f) && !$x24->isWriteable($x5f)) { Mage::throwException(Mage::helper("\x6f\x72\x64\x65\x72\x73e\170\x70\157\x72\164\164\x6fo\x6c")->__("Fi\x6ce\40\x27%\x73\x27\x20\143\141\x6en\x6f\x74 \x62\x65\x20\163ave\144\x2e\x20P\x6c\x65\x61\x73e\x2c \x6d\141\153\145 su\x72e\40\164h\x65 \x64\151\x72e\x63\x74\x6f\x72\171\x20\45\163\x27\40\x69\163\40\167\x72\x69tea\142\x6c\145 \142\171\x20\x77\145b\40\163e\162\166\x65r.", $x5f, $this->getPath()));  } $x24->streamOpen($x5f, "w");  foreach ($x49 as $x61) { $x24->streamWriteCsv($x61, "\x3b");  } $x24->streamClose();  Mage::getSingleton("\143\x6f\x72\145/\x73\145s\x73\x69\x6fn")->addSuccess(Mage::helper("\155\x61ss\x73to\143\x6b\x75\x70\x64\x61te")->__("B\141\x63k\165\x70\40c\x72\145\141t\x65\144\40\72 \40 '%\x73'\56", $x60 . $x5f));  Mage::$x65("\x2d\x2d-\x3e \104\117\116\x45\40\72\40" . $x60 . $x5f, null, "\115\x61s\163\123t\x6fck\x55\x70\x61te.l\157\x67");  return;  } } ; 