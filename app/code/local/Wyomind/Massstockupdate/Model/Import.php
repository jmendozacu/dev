<?php class Wyomind_Massstockupdate_Model_Import extends Mage_Core_Model_Abstract { public $_warnings = array();
 public $_notices = array();  public $_sql = array();  public $_columns = array();  public $_products = array();  public $_stocks = array();  public $_autoInc = 0;  public $_tables = array();  public $_total = false;  public $_is_in_stock = false;  public $x16 = false;  public $_output = array();  public $x17 = array();  public function _construct() { $x57="\163\164r\151s\164\162";  $x58="i\163\x5fr\145\x61\x64a\142\x6c\145";  $x59="\164\x69\x6de";  $x5a="\x6c\x6f\x67";  $x5b="\151s\137a\x72\162\141\171";  $x5c="\152s\x6f\x6e\137\x65\156\143o\x64\145";  $x5d="jso\x6e\137\144\x65c\x6f\144e";  $x5e="\151n\137a\162r\141y";  $x5f="\x61rr\141y\x5fs\160l\151\143\145";  $x60="\141\x72\162ay_u\156\x73\x68\151\146\x74";  $x61="\x73\164r_r\145\x70\154\141c\145";  $x62="t\162im";  $x63="\x63\x6f\165n\164";  $x64="i\155\160l\x6fde";  $x65="\151\163\137\156\165m\x65\162\151c";  $x66="a\x72\162\141\171\x5f\x70\165\x73\x68";  $x67="s\164r\x74\157\x6co\167\145\162";  $x68="\163\x74\x72s\164r";  $x69="\145x\x70\x6c\157d\x65";  $x6a="a\144d\x73\154\141\163\150\x65\x73";  parent::_construct();  $this->_init("\x6da\x73\x73\x73\164\x6fc\153\165p\144\x61\164e\x2fi\155\x70\157\x72t");  } protected function _beforeSave() { $x57="\163\x74\162is\x74\162";  $x58="\151\163\137r\x65a\144\141\142\154\145";  $x59="\x74\151m\x65";  $x5a="l\157\x67";  $x5b="\x69\x73_a\x72r\x61\171";  $x5c="\152\x73\157\156\137\x65nco\x64e";  $x5d="\152\163\157\x6e\x5f\144\145\x63\157\144e";  $x5e="i\156_\141\162r\x61\171";  $x5f="\x61\162\162ay_spl\151c\145";  $x60="a\162ray\137\165nsh\151f\164";  $x61="\x73\x74r\x5f\x72\145\x70la\x63e";  $x62="tr\151m";  $x63="\143\x6f\x75\x6e\164";  $x64="\x69\x6d\x70\154\157\x64\145";  $x65="\151\163\x5fnu\155\145r\151\x63";  $x66="\x61\162r\x61\x79_p\165s\x68";  $x67="st\162\164\x6flow\145r";  $x68="\x73t\162\163t\x72";  $x69="e\170p\154\157\x64e";  $x6a="\141\x64d\x73\x6c\141\x73\150\x65\x73";  if ($this->getFileSystemType() !== "\61") { $x18 = new Varien_Io_File();  $x19 = $x18->getCleanPath(Mage::getBaseDir() . "\x2f" . $this->getFilePath());  if (!$x18->fileExists($x19, false)) { Mage::throwException(Mage::helper("\x6d\141s\x73st\157ck\x75pd\141\164e")->__("\127r\157\x6e\x67\40f\x69le \x70\141th\56 \x27\45\x73'\x20\151s no\164\40\x61\x20f\x69l\x65\56", $x19));  } if ($x57($this->getFilePath(), "\x2e\x63s\x76") < 0) { Mage::throwException(Mage::helper("\x6d\141s\x73st\157ck\x75pd\141\164e")->__("\x57ro\156\x67\x20f\x69\x6c\145\x2e \47\x25\163' is\x20\x6eo\x74\x20a\40\143sv\40fi\154e\x2e", $x19));  } if (!$x58($x19)) { Mage::throwException(Mage::helper("\x6d\141s\x73st\157ck\x75pd\141\164e")->__("\x50l\x65\x61\x73\x65\40m\x61\x6b\x65 \x73\165r\x65\x20\164\x68a\164\40'\x25\163\47\x20\x69\163 r\145a\x64a\x62\x6c\145 \142y \x77e\142\x2dse\162\x76\145r.", $x19));  } } return parent::_beforeSave();  } public function x6b() { $x57="st\x72\151\163tr";  $x58="\151\x73_re\141d\141ble";  $x59="\x74im\145";  $x5a="\x6c\157g";  $x5b="\151\x73_a\162\x72\141\x79";  $x5c="\x6a\x73\157\x6e\x5f\x65\156\x63o\x64\145";  $x5d="j\163\157\156\137\144\145\x63\x6fde";  $x5e="\x69\x6e_\x61r\x72\x61\171";  $x5f="\141\162r\x61y_\x73\x70li\143\145";  $x60="\141rr\x61\171\137\165\156s\x68\151\x66\x74";  $x61="\x73\x74\x72\137\162\145\x70\x6c\x61\x63e";  $x62="\x74\x72\x69\x6d";  $x63="\x63\157\165n\x74";  $x64="\151mpl\157\144e";  $x65="is_\x6e\x75\x6d\x65r\151c";  $x66="a\162\x72a\171\x5f\x70\165\x73\x68";  $x67="st\x72\x74\x6f\x6co\x77\145\x72";  $x68="s\164\x72s\164\x72";  $x69="exp\x6c\157\144e";  $x6a="\141\144\144s\154ashes";  $this->_warnings = array();  $this->_notices = array();  $this->_sql = array();  $this->_columns = array();  $this->_products = array();  $this->_stocks = array();  $this->_autoInc = 0;  $this->_tables = array();  $this->_total = false;  $this->_output = array();  } private function x6c() { $x57="\x73t\x72\x69s\x74\162";  $x58="\x69\x73\x5f\x72\x65\141\x64a\x62\x6c\x65";  $x59="ti\x6d\x65";  $x5a="\x6c\157g";  $x5b="i\x73_\141rray";  $x5c="js\157\x6e\137\145\156\143o\144e";  $x5d="\x6a\x73\x6f\x6e\x5fde\x63\x6f\x64\145";  $x5e="\x69n_a\162r\141\x79";  $x5f="\141\162r\x61\171\137spl\151\x63e";  $x60="\141\162ra\171_un\x73h\151\x66t";
 $x61="\x73t\162\x5f\162\145pl\141c\145";  $x62="tr\x69m";  $x63="\x63\157\165nt";  $x64="\151m\160\x6c\157\x64\x65";  $x65="\151s\x5f\156\x75\x6de\x72i\143";  $x66="ar\x72\141\x79\x5f\160\165s\150";  $x67="s\x74\162t\157\154\x6fw\x65\162";  $x68="st\x72\x73\x74\x72";  $x69="\145\x78\160\154\157\x64\145";  $x6a="ad\144s\x6c\x61\163h\x65\163";  $x1a = $this->getFtpHost();  $x1b = $this->getFtpLogin();  $x1c = $this->getFtpPassword();  $x1d = $this->getFtpDir();  $x1e = $this->getUseSftp();  $x1f = $this->getFtpActive();  if ($x1e) $x20 = new Varien_Io_Sftp();  else $x20 = new Varien_Io_Ftp();  try { $x20->open( array( 'host' => $x1a, 'user' => $x1b, 'username' => $x1b, 'password' => $x1c, 'timeout' => '120', 'path' => $x1d, 'passive' => !($x1f) ) );  if ($x20->cd($x1d)) { $x21 = 'var/tmp/stock_import_' . $x59() . '.csv';  $x18 = new Varien_Io_File();  $x19 = $x18->getCleanPath(Mage::getBaseDir() . '/var/tmp/');  if ($x58($x19)) { $x22 = $x20->read($this->getFilePath(), $x21);  $x20->close();  if (!$x22) { return array("\x54h\x65 \x66\151\154e\40\x27".$this->getFilePath()."'\40can\x6e\157\x74 \142\145\40\x66e\164c\x68\145\144.");  } return $x21;  } else { $x20->close();  return array("\x50le\141se\x20\x6da\153\x65 \x73ur\x65\x20\x74\150\x61t\x20var\x2ft\x6dp\x20\x69\x73\x20writabl\145\x2e");  } } else { $x20->close();  return array("Cannot access '$x1d' on this server.");  } } catch (Exception $x23) { return $x23->getMessage();  } } public function importProcess() { $x57="\x73t\x72i\x73tr";  $x58="is\137\x72\x65\141\x64a\142l\x65";  $x59="\x74ime";  $x5a="l\x6fg";  $x5b="i\163\x5f\141\162ra\171";  $x5c="j\163on\137\145\156c\157d\145";  $x5d="j\163\x6f\156_\x64\145\143\x6f\x64e";  $x5e="in\137\x61\162ra\171";  $x5f="\141r\x72\x61\171\137\163\x70\x6c\x69ce";  $x60="a\162r\141\171\x5fu\x6e\163hi\146t";  $x61="\163\164\162\x5f\162e\160\x6cace";  $x62="\164\x72\x69m";  $x63="\143\x6f\165\156t";  $x64="\x69m\x70\x6co\x64\145";  $x65="i\x73\x5fn\165\155\x65r\x69c";  $x66="\141\x72r\x61\x79\x5f\160\x75\x73h";  $x67="\163\164\x72\x74\157\x6c\x6fwe\162";  $x68="\163t\162\163\164\x72";  $x69="\x65\170p\x6c\157\x64\145";  $x6a="\141\144\144slas\150\x65\x73";  Mage::$x5a("\55-\x2d\x2d\x2d\x2d\55-\55\55-\x2d\55-\x2d\x2d-\x2d\55-\x20\111MP\117RT\x41\124\x49\117\x4e\x20\120\122\x4fC\x45S\x53\40-\x2d-\55\55\x2d\55\55-\55\55\55\x2d\55-", null, "M\x61\x73\163\123\164\157\143k\x55\160a\x74\145.\154\x6fg");  $this->x6b();  $x24 = $this->getFilePath();  if ($this->getFileSystemType() === "\61") { $x22 = $this->x6c();  if ($x5b($x22)) { $x25['status'] = 'error';  $x25['body'] = $x22[0];  die($x5c($x25));  } else { $x24 = $x22;  } } $x18 = new Varien_Io_File();  $x19 = $x18->getCleanPath(Mage::getBaseDir() . "\x2f" . $x24);  $x18->streamOpen($x19, "\162");  Mage::$x5a("\55-\x3e \106\151\154\x65 ope\x6ee\x64\40\72 " . $x19, null, "M\x61\x73\163\123\164\157\143k\x55\160a\x74\145.\154\x6fg");  $x26 = $this->getIdentifierCode() ? $this->getIdentifierCode() : "s\153u";  Mage::$x5a("\55\55\76\40\120\162\157\x64u\143\x74\x73\x20c\x6f\x6cl\x65c\x74e\x64", null, "M\x61\x73\163\123\164\157\143k\x55\160a\x74\145.\154\x6fg");  $x27 = array("\x61\143" => "a\143\164\x69\166\x61\x74\151\157\x6e\137\143\x6fde", "\141k" => "a\x63\164i\166at\151\157\156_\x6be\x79", "\x62\x75" => "\142\x61\163e\137\x75\x72\154", "\155d" => "m\144\65", "\164\150" => "\x74\150i\163", "\x64\155" => "\x5f\x64emo", "ex\164" => "m\x73\151", "\x76\145\x72" => "\63\x2e\70.\x30");  $x28 = Mage::getSingleton("\x63\157r\x65\57\x72\145\x73\157\x75rc\145");  $x29 = $x28->getConnection("\143or\145_\162\x65ad");  $this->_tables["cs\151"] = Mage::getSingleton("\x63\157r\x65\57\x72\145\x73\157\x75rc\145")->getTableName("\x63\141\x74a\x6co\147\x69\156ve\x6et\157\x72\171\x5f\163t\157\x63k\137i\164em");  if (Mage::helper("c\x6fre")->isModuleEnabled("\x57\x79\x6f\x6d\x69n\144\x5f\101\x64\x76ance\144\x69\x6e\166\145\156\164o\162y")) { $this->_tables["a\x69\160"] = Mage::getSingleton("\x63\157r\x65\57\x72\145\x73\157\x75rc\145")->getTableName("\141dv\x61\156\143\x65di\156\x76\x65\156\164o\162\171\137\151\x74e\155");  $this->_tables["\x61\x69\163"] = Mage::getSingleton("\x63\157r\x65\57\x72\145\x73\157\x75rc\145")->getTableName("ad\166\x61n\x63\145d\151\x6e\x76e\156\x74\157\162\171_\163\x74\x6fc\x6b");  $x2a = "S\105L\105\103T\40\115A\130(i\x64\x29\40\x41\123\40\111\116C\40F\122OM\x20" . $this->_tables["a\x69\160"] . "\x20; ";  $x2b = $x29->fetchAll($x2a);  $this->_autoInc = $x2b[0]["\111N\x43"];  Mage::$x5a("\x2d\55>\40\115\x61\170\x20\151\156\143r\x65\x6d\x65n\x74\40\146o\165\156d\40\x23" . $x2b[0]["\111N\x43"] . "\50\x41\x64\166a\x6e\x63\x65\144 \x49n\x76e\156\164or\x79\x29", null, "M\x61\x73\163\123\164\157\143k\x55\160a\x74\145.\154\x6fg");  } $x2c = array( "a\x63\164i\166at\151\157\156_\x6be\x79" => Mage::getStoreConfig("\x6d\x61s\163sto\x63\153\165pd\x61\164\x65\x2fl\151\143\x65\x6es\145\57\141\143t\x69v\x61\x74\x69\157n\137\x6be\171"), "a\143\164\x69\166\x61\x74\151\157\x6e\137\143\x6fde" => Mage::getStoreConfig("\x6d\141\163s\x73\164o\143kupd\141t\145\x2f\x6c\151\x63\x65\156\163e/a\x63t\x69vat\x69\x6f\x6e\x5f\143ode"), "\142\x61\163e\137\x75\x72\154" => Mage::getStoreConfig("w\145\142\x2f\x73e\x63ur\145/b\x61\163e\137u\x72\154"), );  $x2d = $x5d($this->getMapping());  foreach ($x2d->columns as $x2e => $x2f) { if (!$x5e($x2f->id, array("\x6eo\x74\x2d\165\x73\x65\x64", "\x74ot\141l", "\151\x73_\151\x6e\x5f\163t\157\x63k", "man\x61\147e_l\157\x63\x61\x6c\x5f\x73\164\157\x63\153"))) { $this->_columns[] = $x2f->id;  } elseif ($x5e($x2f->id, array("\x74ot\141l"))) { $this->_columns[] = "\x74ot\141l";  $this->_total = $x2e + 1;  } elseif ($x5e($x2f->id, array("\151\x73_\151\x6e\x5f\163t\157\x63k"))) { $this->_columns[] = "\151\x73_\151\x6e\x5f\163t\157\x63k";  $this->_is_in_stock = $x2e + 1;  } elseif ($x5e($x2f->id, array("man\x61\147e_l\157\x63\x61\x6c\x5f\x73\164\157\x63\153"))) { $this->_columns[] = "man\x61\147e_l\157\x63\x61\x6c\x5f\x73\164\157\x63\153";  $this->_manage_local_stock = $x2e + 1;  } else { $this->_columns[] = false;  } } Mage::$x5a("\55\55>\x20\103\x6fl\x75\155\x6e\40\x6d\141\x70\160\151n\147\40a\x6e\x61\154\x79\x7aed", null, "M\x61\x73\163\123\164\157\143k\x55\160a\x74\145.\154\x6fg");  if ($x2c[$x27["\x61\143"]] != $x27["\155d"]($x27["\155d"]($x2c[$x27["\141k"]]) . $x27["\155d"]($x2c[$x27["\x62\x75"]]) . $x27["\155d"]($x27["ex\164"]) . $x27["\155d"]($x27["\x76\145\x72"]))) { $$x27["ex\164"] = "\166\141\154i\x64";  $$x27["\164\150"]->$x27["\x64\155"] = true;  } else { $$x27["\164\150"]->$x27["\x64\155"] = false;  $$x27["ex\164"] = "\166\141\154i\x64";  } if (!isset($$x27["ex\164"]) || $$x27["\164\150"]->$x27["\x64\155"]) { $$x27["\164\150"]->$x27["\x64\155"] = true;  return $$x27["\164\150"];  } Mage::$x5a("-\x2d\x3e\x20\120\162\x65\x70\141\162i\156\147\40\x4d\171S\161l\x20q\x75\x65r\x69e\163", null, "M\x61\x73\163\123\164\157\143k\x55\160a\x74\145.\154\x6fg");  $x30 = $this->getSkuOffset() - 1;  $x31 = new Varien_Io_File();  $x31->setAllowCreateFolders(true);  $x32 = Mage::getStoreConfig("m\x61\163\163\x73t\157\143\x6b\165pd\x61\164\x65/\163ett\x69\x6eg\x73/\x73\161\x6c\x5f\146\x69\x6ce");  $x33 = Mage::getStoreConfig("ma\x73\163\x73\164\157c\153\165pd\141t\145\57\163\145\164t\x69\156g\163\x2fsq\154_d\151\162");  $x19 = $x18->getCleanPath(Mage::getBaseDir() . '/' . $x33);
 if (!$x31->fileExists($x19, false)) { Mage::throwException(Mage::helper('massstockupdate')->__('Please create the specified folder "%s".', $x19));  } if (!$x31->isWriteable($x19)) { Mage::throwException(Mage::helper('massstockupdate')->__('Please make sure that "%s" is writable by web-server.', $x19));  } $x31->open(array('path' => $x33));  $x31->streamOpen($x32, 'w');  if ($this->getAutoSetTotal() == 2) { $x31->streamWrite("\123\105\x54 \x66\157\162ei\147\156\x5f\x6be\171_\x63\x68\145\143\153\x73\x3d0\x3b");  } if ($this->getFileEnclosure() != "n\157\x6e\145") { while (false !== ($x34 = $x18->streamReadCsv($this->getFileSeparator(), $this->getFileEnclosure()))) { $x35 = $x5f($x34, $x30, 1);  $x60($x34, $x35[0]);  $this->x6d($x34);  foreach ($this->_sql as $x2a) { $x31->streamWrite($x61(array("\x0a", "\40 "), array("\x20", ""), $x62($x2a)) . "\x0a");  } } } else { while (false !== ($x34 = $x18->streamReadCsv($this->getFileSeparator()))) { $x35 = $x5f($x34, $x30, 1);  $x60($x34, $x35[0]);  $this->x6d($x34);  foreach ($this->_sql as $x2a) { $x31->streamWrite($x61(array("\x0a", "\40 "), array("\x20", "\x20"), $x62($x2a)) . "\x0a");  } } } Mage::$x5a("\x2d\55\76\x20F\x69\x6c\x65 cl\x6fs\x65d\40\72 " . $x19 . $x32, null, "M\x61\x73\163\123\164\157\143k\x55\160a\x74\145.\154\x6fg");  $x18->streamClose();  if ($this->getAutoSetTotal() == 2) { } $x31->streamClose();  if ($x63($this->_warnings)) Mage::getSingleton("\x63\157\162\x65\x2f\x73\145\x73\163\x69o\x6e")->addError($x64("<\x62r\x3e", ($this->_warnings)));  if (Mage::getStoreConfig("ma\163\x73\163\164\x6f\143\153\x75\160\x64\x61\164\145\57s\x65t\x74\x69\x6e\147s\57\x73h\x5f\155\157\144\x65")) { return true;  } $x36 = Mage::getSingleton("\x63\157r\x65\57\x72\145\x73\157\x75rc\145")->getConnection("core\137w\x72i\x74e");  $x36->beginTransaction();  $x37 = true;  Mage::$x5a("\x2d\55\76\x20E\x78ec\165\164\151\156\x67\x20M\x79S\161\154\x20\161\x75e\162\x69\x65\163", null, "M\x61\x73\163\123\164\157\143k\x55\160a\x74\145.\154\x6fg");  $x18 = new Varien_Io_File();  $x18->streamOpen($x19 . $x32, "\162");  while (false !== ($x2a = $x18->streamRead(102400))) { try { $x36->exec($x2a);  } catch (Mage_Core_Exception $x23) { Mage::$x5a("\x20fa\151l\145\144\40\x2d\55>" . $x2a, null, "M\x61\x73\163\123\164\157\143k\x55\160a\x74\145.\154\x6fg");  $x37 = false;  } catch (Exception $x23) { Mage::$x5a("\x20fa\151l\145\144\40\x2d\55>" . $x2a, null, "M\x61\x73\163\123\164\157\143k\x55\160a\x74\145.\154\x6fg");  Mage::getSingleton("\x63\157\162\x65\x2f\x73\145\x73\163\x69o\x6e")->addError($x23->getMessage());  $x37 = false;  } } if (!$x37) { Mage::$x5a("\x2d->\x20\115\x79S\161l\x20R\157\x6c\154\x62\x61c\153", null, "M\x61\x73\163\123\164\157\143k\x55\160a\x74\145.\154\x6fg");  Mage::getSingleton("\x63\157\162\x65\x2f\x73\145\x73\163\x69o\x6e")->addError(Mage::helper("\x6d\141s\x73st\157ck\x75pd\141\164e")->__("\105\162r\157\x72 w\150\x69\x6c\145 pr\157\143\145s\163i\x6e\147.\x20\122ol\x6c\142ack\40h\141pp\145\156e\144."));  $x36->rollback();  return false;  } else { Mage::$x5a("-\55>\40M\x79\x53\161\x6c\x20C\x6f\x6d\x6di\x74", null, "M\x61\x73\163\123\164\157\143k\x55\160a\x74\145.\154\x6fg");  $x36->commit();  $this->setImportedAt(Mage::getSingleton("c\x6fr\x65\57\x64\x61\164\x65")->gmtDate("\131-m\55\x64\x20\110\72\151\x3as"));  $this->save();  $x38 = Mage::getSingleton('index/indexer')->getProcessByCode('cataloginventory_stock');  $x38->reindexAll();  Mage::$x5a("\x2d\55\76\x20\x53\164o\x63k\x20re\x2d\151\x6ede\x78\x65d", null, "M\x61\x73\163\123\164\157\143k\x55\160a\x74\145.\154\x6fg");  $x18->open(array('path' => $x33));  $x18->rm($x32);  return true;  } } private function x6d($x39) { $x57="s\x74ri\163tr";  $x58="i\x73\137\162e\x61\144a\142\154e";  $x59="\x74i\x6d\145";  $x5a="\x6c\157\x67";  $x5b="i\163\x5f\141r\x72\141y";  $x5c="\x6a\163\157n\x5f\145nco\144\x65";  $x5d="\152\163on\x5fd\145\x63\157\144e";  $x5e="i\156\137ar\x72\x61\x79";  $x5f="\x61\x72\162\141\x79_s\x70l\151ce";  $x60="a\x72\162a\x79\137\x75\156sh\151\146\x74";  $x61="s\164r_r\x65p\x6ca\143\x65";  $x62="t\x72\x69\155";  $x63="co\165n\x74";  $x64="i\155\x70\154od\x65";  $x65="\151\x73_\156\x75\155\145r\x69c";  $x66="a\x72\162\x61\171\x5f\x70us\x68";  $x67="s\x74rt\x6f\x6c\x6f\167er";  $x68="s\164\x72\163t\x72";  $x69="\x65\x78\x70\x6c\x6fd\145";  $x6a="\141\x64ds\154a\163\150\145\163";  $this->_sql = array();  foreach ($x39 as $x3a => $x3b) $x39[$x3a] = $x62($x3b);  if ($this->getUseCustomRules()) { $x3c = $this->getCustomRules();  eval($x61('$C[', '$x39[', $x3c));  } $x3d = array();  $x3e = array();  $x26 = $this->getIdentifierCode() ? $this->getIdentifierCode() : "s\153u";  $x3f = Mage::getModel('eav/config')->getAttribute(Mage_Catalog_Model_Product::ENTITY, $x26)->getFrontendLabel();  $x40 = Mage::getModel("\143\x61\x74\x61\x6cog\57pr\x6f\144u\143\164")->loadByAttribute($x26,$x39[0]);  if (isset($x40) && !empty($x40)) { $x41 = $x40->getId();  $x42 = array();  if (Mage::helper("c\x6fre")->isModuleEnabled("\x57\x79\x6f\x6d\x69n\144\x5f\101\x64\x76ance\144\x69\x6e\166\145\156\164o\162y")) { $x43 = Mage::getModel("\141d\x76\141nc\145\x64\151n\x76\x65\x6e\164ory\57\x73\x74\x6fck")->getCollection();  $x43->getSelect()->where('product_id = '.$x41);  foreach ($x43->getData() as $x44) { $x42[$x44['product_id']] = $x44['id'];  };  Mage::$x5a("-\55>\x20Lo\143\x61\154\x20\163to\x63\153\x73\40\143\x6f\154\154\145\x63\164\145d \50Ad\x76a\x6ec\x65\x64 \111\x6e\x76\145n\x74\157ry\51", null, "M\x61\x73\163\123\164\157\143k\x55\160a\x74\145.\154\x6fg");  } if (isset($x42[$x41])) { $x45 = $x42[$x41];  } else { $this->_autoInc++;  $x45 = $this->_autoInc ;  } $x3d["I\104"] = $x41;  $x46 = true;  $x3d["\x73\x74a\x74u\163"] = $x46;  $x3d["\x74ot\141l"] = 0;  $x3d["i\156\137s\164o\143k"] = null;  $x47 = 0;  foreach ($x39 as $x2e => $x48) { if (isset($this->_columns[$x2e - 1]) && $x2e > 0) { if (!$this->_total) { if ($x65($x48) && $x46) { if ($this->_columns[$x2e - 1] != "\x74ot\141l" && $this->_columns[$x2e - 1] != "\151\x73_\151\x6e\x5f\163t\157\x63k" && ($this->_columns[$x2e - 1] == "u\x73\145\x64" || $x65($this->_columns[$x2e - 1]))) $x3d["\x74ot\141l"]+=$x48;  $x46 = true;  } } else { if ($this->_total && $this->_columns[$x2e - 1] == "\x74ot\141l") { $x3d["\x74ot\141l"] = $x48;  if ($x65($x48)) $x46 = true;  else $x46 = false;  } } if (Mage::helper("c\x6fre")->isModuleEnabled("\x57\x79\x6f\x6d\x69n\144\x5f\101\x64\x76ance\144\x69\x6e\166\145\156\164o\162y") && $x46) { if ($x65($x48) && $x65($this->_columns[$x2e - 1])) { $x49 = " \x52\105P\x4cA\103E\x20\x49\x4eT\117\40\x60" . $this->_tables["\x61\x69\163"] . "\140 (\x60\x69\144\140, \140l\x6fca\x6c\163\164\157\143\x6b\137\151\x64\140\54`\x70l\x61\143e\137\x69d`\x2c\140\x71\x75\x61n\x74\x69\164y\x5fi\156_\x73\164\x6fc\153`\54\140\x70\x72\157d\x75\x63\x74\x5f\x69\144\140\54\140\142\x61\143\153\157\162d\145r_a\x6c\x6cow\x65\x64\x60\x2c\140u\x73e_\x63on\146\x69\x67_\163\x65\164\x74i\x6eg\x5ff\157\x72\x5f\142a\x63\153\x6f\162de\x72s\140) \x76a\154\x75e\163(\x0d \x20 \x20\40\x20 \40\x20\40 \40\x20\40\40\x20 \40\x20\x20\x20\40\40\x20 \x20\x20 \x20\x20 \40\40\x49F((\123E\x4c\x45\x43\124\40c\157\165\x6e\164\50\140\x69\x64\140\x29\40FR\117M\40\x60" . $this->_tables["\x61\x69\163"] . "\140 \x41S \141\x20\x57H\105R\105\x20`\x70l\x61\143e_\151\x64\140\x3d" . $this->_columns[$x2e - 1] . "\40\101ND \x20\x60\160\x72\157\144uc\164_i\x64`\75" . $x41 . "\x29=\61\54(\x53ELE\x43T\x20\140\151d\140\40FRO\x4d " . $this->_tables["\x61\x69\163"] . " \x41S \x61\40\x57\x48\105\122\x45\40\140p\x6cac\145\137\151\144`\x3d" . $this->_columns[$x2e - 1] . "\x20\101N\104\40`\x70\x72o\x64\x75\143\x74_\151\144\x60=" . $x41 . "),NULL) ,$x45," . $this->_columns[$x2e - 1] . ",$x48,$x41,IFNULL((SELECT `backorder_allowed` FROM `" . $this->_tables["\x61\x69\163"] . "\140\x20\x41\123 \140b\x60\40W\x48ER\105\x20\140\160\154\x61ce_i\144\x60\75" . $this->_columns[$x2e - 1] . "\x20\101N\104\40`\x70\x72o\x64\x75\143\x74_\151\144\x60=" . $x41 . "\x29\x2c0),\x49\106\116U\114\x4c((S\x45L\x45C\124 \140\x75\x73\x65_\143o\156\x66i\147\x5fs\145\x74\164\151n\x67\x5f\146\x6f\x72\x5fb\x61\x63\x6bo\162\x64\145r\x73`\40F\122\x4fM\40`" . $this->_tables["\x61\x69\163"] . "\x60\x20\101\x53\x20`\143\x60 W\x48\x45\x52\105\x20`\160l\141c\145\x5f\151\x64\x60\75" . $this->_columns[$x2e - 1] . "\x20\101N\104\40`\x70\x72o\x64\x75\143\x74_\151\144\x60=" . $x41 . ")\x2c\61)\51\x3b";  $x66($this->_sql, $x49);  $x3e[] = "\55\x49\106\116\125\114L((S\105LE\x43T\x20\x60q\165\141\x6e\164i\164y_\151\x6e_s\x74\x6fc\153`\40F\122\117M\40`" . $this->_tables["\x61\x69\163"] . "\x60\40\127HE\x52\x45\40`p\x6ca\x63\145_\x69\144`\x3d" . $this->_columns[$x2e - 1] . "\40\101ND \x20\x60\160\x72\157\144uc\164_i\x64`\75" . $x41 . "\40\51\x2c0\51";  } } if (!$this->getAutoSetInstock()) { if ($this->_is_in_stock && $this->_columns[$x2e - 1] == "\151\x73_\151\x6e\x5f\163t\157\x63k") { if ($x5e($x67($x48), array("\61", "\164\162\x75\145", "y\145\163", "\x6fn", "in st\157\143\153", "\151\156st\157\x63\x6b", "\x61\x76ai\x6c\141\142\154e"))) $x3d["i\156\137s\164o\143k"] = true;  else $x3d["i\156\137s\164o\143k"] = false;  } } else { if ($x3d["\x74ot\141l"] > 0) $x3d["i\156\137s\164o\143k"] = true;
 else $x3d["i\156\137s\164o\143k"] = false;  } if ($this->_manage_local_stock && $this->_columns[$x2e - 1] == "man\x61\147e_l\157\x63\x61\x6c\x5f\x73\164\157\x63\153") { if ($x5e($x67($x48), array("\61", "\164\162\x75\145", "y\145\163", "\x6fn", "in st\157\143\153", "\151\156st\157\x63\x6b", "\x61\x76ai\x6c\141\142\154e"))) $x3d["man\x61\147e_l\157\x63\x61\x6c\x5f\x73\164\157\x63\153"] = 1;  else $x3d["man\x61\147e_l\157\x63\x61\x6c\x5f\x73\164\157\x63\153"] = 0;  } else { $x3d["man\x61\147e_l\157\x63\x61\x6c\x5f\x73\164\157\x63\153"] = 1;  } if ($x68($this->_columns[$x2e - 1], "\141tt\x72i\x62u\x74e")) { $x4a = ($x69('-', $this->_columns[$x2e - 1]));  $x4b = Mage::getSingleton("\x63\157r\x65\57\x72\145\x73\157\x75rc\145")->getTableName("\143a\x74a\x6c\x6f\147\137\160\x72\157\144\x75\x63t_\x65\156\x74\x69\x74\171_" . $x4a[3]);  $x49 = "UPDATE `$x4b` SET `value`='" . $x6a($x48) . "\x27\x20\x57\110E\122\x45\40`\x65\156\164\151t\x79_\151\x64\x60=\x27" . $x41 . "\x27 \x41\116\x44\40\140\141t\164rib\x75\164\x65\x5f\x69\x64\140\75'" . $x4a[2] . "'\x3b";  $x66($this->_sql, $x49);  } $x3d[$x47]["v\141\154u\145"] = $x48;  $x3d[$x47]["\143\x6fd\x65"] = $this->_columns[$x2e - 1];  $x47++;  } };  $x3d["\x73\x74a\x74u\163"] = $x46;  $x4c = $x3d["\x74ot\141l"];  if ($this->getAutoSetTotal() == 2) { if ($x63($x3e)) $x4c = "(\x53\105\x4c\x45C\124\40\50\111F\x4eU\114L\50S\x55\115\x28\x60\161\165a\156\164\x69t\x79_i\x6e_\163\x74o\x63k\140\51\x2c\x30)" . $x64('', $x3e) . "+$x4c) FROM " . $this->_tables["\x61\x69\163"] . " WHERE `product_id`=$x41)";  else { $x46 = false;  } } $x4d = $x3d["i\156\137s\164o\143k"];  if (Mage::helper("c\x6fre")->isModuleEnabled("\x57\x79\x6f\x6d\x69n\144\x5f\101\x64\x76ance\144\x69\x6e\166\145\156\164o\162y")) { if ($x46) { $x49 = "\122\105\120L\x41\103\105\x20\111\116\x54\x4f \140" . $this->_tables["a\x69\160"] . "` values($x45,$x41," . $x3d["man\x61\147e_l\157\x63\x61\x6c\x5f\x73\164\157\x63\153"] . "\51\x3b";  $x60($this->_sql, $x49);  } } if (($x46)) { if ($x4d === true || $x4d === false) { $x4e = "\54\40\140\x69s_i\156\x5f\x73\x74ock`";  $x4f = ($x4d) ? '=1' : '=0';  if ($this->getAutoSetTotal() == 2) { $x4f = "= IF ($x4c>0,1,0)";  } } else { $x4e = null;  $x4f = null;  } $x49 = "\125\120\104A\x54\x45\40`" . $this->_tables["cs\151"] . "\x60\40\x53\105T " . "`product_id`='$x41'," . "`qty`=$x4c," . "\x60\163t\x6f\x63k\137\151d\140\x3d \61" . "$x4e $x4f WHERE `product_id`='$x41'; ";  $x60($this->_sql, $x49);  } if ($x46) { $this->_notices[] = "$x3f <i>$x39[0]</i> has been updated";  } else { Mage::$x5a("\52\x20\x50r\157d\x75c\164\x20\43" . $x39[0] . "\40\x68a\x73\40\x62\x65\145\156\40\151\147n\x6fr\x65\x64\40\144ue\40to\x20s\x6fm\145\x20\156o\156\40\x63o\156\x73\151\x73te\156\164 \144a\x74\x61\x2e", null, "M\x61\x73\163\123\164\157\143k\x55\160a\x74\145.\154\x6fg");  $this->_warnings[] = "$x3f <i>$x39[0]</i> has been ignored due to some non consistent data.";  } $this->_output[] = $x3d;  } else { Mage::$x5a("\52\x20\x50r\157d\x75c\164\x20\43" . $x39[0] . "\40\144\157\145\x73\x6e\x27t \x65xi\x73\x74\56\40P\162o\x64uct \150a\163\x20\x62ee\156\x20\151g\156o\x72\x65\144\x2e", null, "M\x61\x73\163\123\164\157\143k\x55\160a\x74\145.\154\x6fg");  $this->_warnings[] = "$x3f <i>$x39[0]</i> doesn't exist. Product has been ignored.";  } } function backup() { $x57="\163\x74r\151\x73\x74\162";  $x58="\x69s_\x72\145a\144\141\x62\154e";  $x59="\x74\151\x6d\145";  $x5a="l\x6f\147";  $x5b="\x69s_a\x72\162\x61\x79";  $x5c="\x6as\157\x6e\137\145\x6e\x63o\144\x65";  $x5d="\x6as\x6fn\137\144\x65c\x6fde";  $x5e="\151\x6e_\141r\x72ay";  $x5f="\141\x72ra\171\x5f\163\160\154\x69c\145";  $x60="\x61rra\171\x5f\x75\x6e\x73\x68\x69f\x74";  $x61="\x73\x74r\x5f\x72e\160\x6c\141\x63\145";  $x62="\164rim";  $x63="co\x75\x6et";  $x64="\x69\x6d\x70\x6c\157\144\145";  $x65="\151\163\x5f\156\165\155\145r\151\x63";  $x66="\x61\162r\141\x79\x5f\x70u\x73\x68";  $x67="s\164\x72\164\157\154\157wer";  $x68="\x73\164\162\163t\x72";  $x69="\x65\170p\154\157\x64\x65";  $x6a="\141\144\x64sl\x61she\x73";  return;  $x2a = array();  $x50 = array();  $x51 = array();  $x28 = Mage::getSingleton("\x63\157r\x65\57\x72\145\x73\157\x75rc\145");  $x29 = $x28->getConnection("\143or\145_\162\x65ad");  $this->_tables["cs\151"] = Mage::getSingleton("\x63\157r\x65\57\x72\145\x73\157\x75rc\145")->getTableName("\x63\141\x74a\x6co\147\x69\156ve\x6et\157\x72\171\x5f\163t\157\x63k\137i\164em");  $this->_tables["\143\x70\x65"] = Mage::getSingleton("\x63\157r\x65\57\x72\145\x73\157\x75rc\145")->getTableName("c\x61\x74\x61$x5a\137pr\x6f\x64\165\x63\x74\x5f\x65\x6e\x74\x69ty");  $x66($x2a, "L\105F\x54\x20JOI\116 \x60" . $this->_tables["\143\x70\x65"] . "`\40\101\123\40\140\143\x70\145`\x20O\x4e\x20`c\x70e\140.\x60\145n\x74\x69\164y\x5f\151d\x60\x3d\x60csi\x60\56`p\162o\144\165\x63\164\137\x69\144`");  if (Mage::helper("c\x6fre")->isModuleEnabled("\x57\x79\x6f\x6d\x69n\144\x5f\101\x64\x76ance\144\x69\x6e\166\145\156\164o\162y")) { $x50[] = null;  $x51[] = null;  $this->_tables["\x61\x69\163"] = Mage::getSingleton("\x63\157r\x65\57\x72\145\x73\157\x75rc\145")->getTableName("ad\166\x61n\x63\145d\151\x6e\x76e\156\x74\157\162\171_\163\x74\x6fc\x6b");  $x52 = Mage::getModel("\160o\151\156t\x6f\146sa\154\x65\x2f\x70oi\x6etofs\x61l\145")->getPlaces();  foreach ($x52 as $x53) { $x66($x2a, "L\105F\x54\x20JOI\116 \x60" . $this->_tables["\x61\x69\163"] . "\x60 \x41\123 \x60ai\x5f" . $x53->getPlaceId() . "\x60\40\x4fN\40\x60ai\137" . $x53->getPlaceId() . "\140\x2e`\160\x72o\x64\x75\143\x74_\151\144`\x3d`\143\x70\x65\x60.\x60\x65\156\164\x69\x74\171_\x69d\140\40AN\104\40\x60a\x69\x5f" . $x53->getPlaceId() . "\140.`\x70l\141c\x65\137i\x64`\x3d" . $x53->getPlaceId() . "");  $x50[] = "\141\x69\x5f" . $x53->getPlaceId() . ".`\x71uan\164\151ty\x5fin\137\x73\x74\157c\153\x60\x20\x41\123 \x60\141i\x5f\x73t\157ck_" . $x53->getPlaceId() . "`";  } } $x60($x2a, "\123\105\x4cE\x43\x54\x20\x20`c\x70e\x60.\140\163\x6b\165`\x20" . $x64(', ', $x50) . "\54\x20`c\x73i\140\x2e\140\x71ty`,`\x63s\x69\x60\56`\x69\163_\x69n\x5f\163\164o\143\x6b\x60\40F\122\117\x4d\40\x60" . $this->_tables["cs\151"] . "\x60\x20A\x53 \x60\143\163i`");  $x66($x2a, "W\110\x45RE\40\x60s\x6b\x75` \x49\123\x20\x4eO\124\40\x4e\125L\x4c\40" . $x64("\x20\x41\116\104\40", $x51) . "");  Mage::$x5a("\55\x2d\55\x2d\x2d\55---\55--\55--\x2d\x2d\x2d-\55 B\x41C\x4b\125P\x20\x50\x52O\103\105\123\123 \x2d\x2d\55--\55\55\55\55\55\55\55-\55\x2d-\55\x2d\55\55", null, "M\x61\x73\163\123\164\157\143k\x55\160a\x74\145.\154\x6fg");  Mage::$x5a("\x2d-\x2d>\x20\x4d\x79\x53ql\x20\162\x65que\x73\x74\40\x3a\40" . $x64(' ', $x2a), null, "M\x61\x73\163\123\164\157\143k\x55\160a\x74\145.\154\x6fg");  $x39 = $x29->fetchAll($x64("\x20", $x2a));  $x18 = new Varien_Io_File();  $x18->setAllowCreateFolders(true);  $x54 = Mage::getStoreConfig("mas\x73\163t\x6fcku\x70\144\141t\x65\57\x73\x65\164\x74in\147s/\142\141\143ku\x70\137f\x69l\145") . "-" . $x59() . "\x2e\x63s\x76";  $x55 = Mage::getStoreConfig("\155\x61\x73\x73\x73\164\157\143\x6b\165\x70\x64a\x74e\x2f\163\x65\x74\164\x69\156\x67\x73\57b\x61\x63kup\137di\162");  $x18->open(array("\x70\141th" => Mage::getBaseDir() . "\x2f" . $x55));  if ($x18->fileExists($x54) && !$x18->isWriteable($x54)) { Mage::throwException(Mage::helper("\157r\144\145\x72\x73e\170\160o\x72t\164\157\x6fl")->__("\x46\x69l\x65 '\45s\47\x20ca\x6e\156\157\164\40b\x65\40\x73a\x76\145\144\x2e\x20Pl\x65as\x65, \x6d\141\153e \163ur\145\40\x74\x68\x65\x20\x64\151\x72ect\157\x72y\40%\x73\x27\40\151s\40\167\162i\164\145\141\142\x6c\x65 \142\x79 w\145\142 \163\x65\162v\145\162\56", $x54, $this->getPath()));  } $x18->streamOpen($x54, "\x77");  foreach ($x39 as $x56) { $x18->streamWriteCsv($x56, "; ");  } $x18->streamClose();  Mage::getSingleton("\x63\157\162\x65\x2f\x73\145\x73\163\x69o\x6e")->addSuccess(Mage::helper("\x6d\141s\x73st\157ck\x75pd\141\164e")->__("\x42\x61c\x6bu\160\40\143r\x65ate\x64\40\72\x20\x20\40\47%s'\x2e", $x55 . $x54));  Mage::$x5a("--\x2d\76\40D\x4fNE \x3a " . $x55 . $x54, null, "M\x61\x73\163\123\164\157\143k\x55\160a\x74\145.\154\x6fg");  return;  } } ; 
